#!/usr/bin/env node
import { createRequire } from 'module';const require = createRequire(import.meta.url);
var $l=Object.create;var fn=Object.defineProperty;var Rl=Object.getOwnPropertyDescriptor;var Bl=Object.getOwnPropertyNames;var jl=Object.getPrototypeOf,Ul=Object.prototype.hasOwnProperty;var v=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var y=(t,e)=>()=>(t&&(e=t(t=0)),e);var x=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Xe=(t,e)=>{for(var r in e)fn(t,r,{get:e[r],enumerable:!0})},ql=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Bl(e))!Ul.call(t,i)&&i!==r&&fn(t,i,{get:()=>e[i],enumerable:!(n=Rl(e,i))||n.enumerable});return t};var $=(t,e,r)=>(r=t!=null?$l(jl(t)):{},ql(e||!t||!t.__esModule?fn(r,"default",{value:t,enumerable:!0}):r,t));var ot,rr,nr=y(()=>{ot=globalThis.process?.argv||[],rr=(t=ot[2])=>ot.filter(e=>!e.startsWith("--")).slice(ot.indexOf(t)+1)});var un,Wl,Fi,pn=y(()=>{un=()=>globalThis.process?.env||{},Wl=/\$([\w+]+)/gm,Fi=(t,e=un(),r=Wl)=>t.replace(r,(n,i)=>e[i]||n)});var Vl,R,Hl,G,gg,Nt,Ai,he=y(()=>{nr();pn();Vl=new Set(ot),R=t=>Vl.has(t),Hl=ot.filter(t=>t.startsWith("--")&&t.includes("=")).map(t=>t.split("=")).reduce((t,[e,r])=>(t[e]=r,t),{}),G=t=>Hl[t],gg=R("--dry-run"),Nt=()=>R("--verbose")||un().VERBOSE==="true",Ai=Nt()});var $e,$i,Re,le,N,j,Gl,d,k=y(()=>{he();$e=(t="",...e)=>console.log(t.padEnd(9),"|",...e),$i=(...t)=>$e("",...t),Re=(...t)=>$e("\u{1F7E2} DONE",...t),le=(...t)=>console.error("\u{1F534} ERROR".padEnd(9),"|",...t),N=(...t)=>$e("\u{1F535} INFO",...t),j=(...t)=>$e("\u{1F7E0} WARN",...t),Gl=0,d=(...t)=>Nt()&&$e(`\u{1F7E1} ${Gl++}`,...t)});import{kebabCase as Jl}from"change-case";var Be,Ri,Bi,at=y(()=>{he();Be=()=>{let t=G("--src-path")||process.env.PLASMO_SRC_PATH||"src",e=G("--build-path")||process.env.PLASMO_BUILD_PATH||"build",r=G("--tag")||process.env.PLASMO_TAG||(process.env.NODE_ENV==="production"?"prod":"dev"),n=Jl(G("--target")||process.env.PLASMO_TARGET||"chrome-mv3"),[i,s]=n.split("-"),o=G("--entry")||"popup",a=G("--env");return{browser:i,manifestVersion:s,tag:r,srcPath:t,buildPath:e,target:n,entry:o,envPath:a}},Ri=`      --target=[string]           set the target (default: chrome-mv3)
      --tag=[string]              set the build tag (default: dev or prod depending on NODE_ENV)
      --src-path=[path]           set the source path relative to project root (default: src)
      --build-path=[path]         set the build path relative to project root (default: build)
      --entry=[name]              entry point name (default: popup)
      --env=[path]                relative path to top-level env file
      --no-cs-reload              disable content script auto reloading`,Bi=`
    
    init

      --entry=[name]              entry files (default: popup)
      --with-<name>               use an example template

    dev     

${Ri}

    build

${Ri}
      --zip                       zip the build output
`});var fe,ir,Ze=y(()=>{k();dn();at();fe=()=>{console.log("\u{1F7E3} Plasmo v0.90.5"),console.log("\u{1F534} The Browser Extension Framework")},ir=()=>{$e("\u{1F7E0} CMDS",mn.join(" | ")),$e("\u{1F7E1} OPTS",Bi)}});var ji={};Xe(ji,{default:()=>Yl});async function zl(){fe(),ir()}var Yl,Ui=y(()=>{Ze();Yl=zl});var qi={};Xe(qi,{default:()=>Xl});async function Kl(){N("Start the extension development...")}var Xl,Wi=y(()=>{k();Xl=Kl});import{constants as hn}from"fs";import{access as Zl,mkdir as Ql,readdir as ef,stat as Vi}from"fs/promises";async function gn(t,e){try{return await Zl(t,e),!0}catch{return!1}}async function sr(t){return gn(t,hn.W_OK)}async function or(t){return gn(t,hn.R_OK)}async function A(t){return gn(t,hn.F_OK)}async function Hi(t){try{return(await Vi(t)).isDirectory()}catch{return!1}}async function ar(t){try{return(await Vi(t)).isFile()}catch{return!1}}async function rf(t){let e=(await ef(t,{withFileTypes:!0})).filter(r=>!tf.has(r.name)).filter(r=>!/\.iml$/.test(r.name));if(e.length>0){d(`Found conflicting contents in ${t}`);let r=e.reduce((n,i)=>`${n}
	${i.name}${i.isDirectory()?"/":""}`,"");return d(r),!1}return!0}async function Gi(t){if(!await sr(t))d("Directory does not exist, creating..."),await Ql(t);else{if(d("Directory exists, checking if it is empty..."),!await rf(t))throw new Error(`Directory ${t} is not empty.`);if(d("Checking if directory is writable..."),!await sr(t))throw new Error(`Directory ${t} is not accesible.`)}}var tf,X=y(()=>{k();tf=new Set([".DS_Store",".git",".gitattributes",".gitignore",".gitlab-ci.yml",".hg",".hgcheck",".hgignore",".idea",".npmignore",".travis.yml","LICENSE","Thumbs.db","docs","mkdocs.yml","npm-debug.log","yarn-debug.log","yarn-error.log",".pnpm-debug.log"])});import{existsSync as nf}from"fs";import{basename as sf,resolve as se}from"path";import{cwd as of}from"process";var ct,cr=y(()=>{at();ct=(t=of())=>{let e=Be();process.env.PLASMO_PROJECT_DIR=t;let r=sf(t);process.env.PLASMO_SRC_PATH=e.srcPath;let n=se(t,e.srcPath);process.env.PLASMO_SRC_DIR=nf(n)?n:t,process.env.PLASMO_BUILD_PATH=e.buildPath;let i=se(t,e.buildPath);process.env.PLASMO_BUILD_DIR=i;let s=`${e.target}-${e.tag}`,o=se(i,s),a=se(t,".plasmo"),l=se(a,"cache");return{packageName:r,projectDirectory:t,buildDirectory:i,distDirectory:o,distDirectoryName:s,sourceDirectory:process.env.PLASMO_SRC_DIR,packageFilePath:se(t,"package.json"),gitIgnorePath:se(t,".gitignore"),assetsDirectory:se(t,"assets"),parcelConfig:se(t,".parcelrc"),dotPlasmoDirectory:a,cacheDirectory:l,plasmoVersionFilePath:se(l,"plasmo.version.json"),staticDirectory:se(a,"static"),genAssetsDirectory:se(a,"gen-assets"),entryManifestPath:se(a,`${e.target}.plasmo.manifest.json`)}}});import af from"@expo/spawn-async";import cf from"semver";async function yn(t){let e=await af(t,["--version"]),r=cf.valid(e.stdout.trim())||void 0;return{name:t,version:r}}async function lt(){try{let t=process.env.npm_config_user_agent;if(t){if(t.startsWith("yarn"))return{name:"yarn"};if(t.startsWith("pnpm"))return{name:"pnpm"}}try{return await yn("pnpm")}catch{return await yn("yarn")}}catch{return await yn("npm")}}var lr=y(()=>{});var q=x(_n=>{"use strict";_n.fromCallback=function(t){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")t.apply(this,e);else return new Promise((r,n)=>{t.call(this,...e,(i,s)=>i!=null?n(i):r(s))})},"name",{value:t.name})};_n.fromPromise=function(t){return Object.defineProperty(function(...e){let r=e[e.length-1];if(typeof r!="function")return t.apply(this,e);t.apply(this,e.slice(0,-1)).then(n=>r(null,n),r)},"name",{value:t.name})}});var zi=x((qg,Ji)=>{var je=v("constants"),lf=process.cwd,fr=null,ff=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return fr||(fr=lf.call(process)),fr};try{process.cwd()}catch{}typeof process.chdir=="function"&&(wn=process.chdir,process.chdir=function(t){fr=null,wn.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,wn));var wn;Ji.exports=uf;function uf(t){je.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(t),t.lutimes||r(t),t.chown=s(t.chown),t.fchown=s(t.fchown),t.lchown=s(t.lchown),t.chmod=n(t.chmod),t.fchmod=n(t.fchmod),t.lchmod=n(t.lchmod),t.chownSync=o(t.chownSync),t.fchownSync=o(t.fchownSync),t.lchownSync=o(t.lchownSync),t.chmodSync=i(t.chmodSync),t.fchmodSync=i(t.fchmodSync),t.lchmodSync=i(t.lchmodSync),t.stat=a(t.stat),t.fstat=a(t.fstat),t.lstat=a(t.lstat),t.statSync=l(t.statSync),t.fstatSync=l(t.fstatSync),t.lstatSync=l(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(c,u,p){p&&process.nextTick(p)},t.lchmodSync=function(){}),t.chown&&!t.lchown&&(t.lchown=function(c,u,p,m){m&&process.nextTick(m)},t.lchownSync=function(){}),ff==="win32"&&(t.rename=typeof t.rename!="function"?t.rename:function(c){function u(p,m,h){var g=Date.now(),_=0;c(p,m,function S(C){if(C&&(C.code==="EACCES"||C.code==="EPERM"||C.code==="EBUSY")&&Date.now()-g<6e4){setTimeout(function(){t.stat(m,function(T,Y){T&&T.code==="ENOENT"?c(p,m,S):h(C)})},_),_<100&&(_+=10);return}h&&h(C)})}return Object.setPrototypeOf&&Object.setPrototypeOf(u,c),u}(t.rename)),t.read=typeof t.read!="function"?t.read:function(c){function u(p,m,h,g,_,S){var C;if(S&&typeof S=="function"){var T=0;C=function(Y,de,Fe){if(Y&&Y.code==="EAGAIN"&&T<10)return T++,c.call(t,p,m,h,g,_,C);S.apply(this,arguments)}}return c.call(t,p,m,h,g,_,C)}return Object.setPrototypeOf&&Object.setPrototypeOf(u,c),u}(t.read),t.readSync=typeof t.readSync!="function"?t.readSync:function(c){return function(u,p,m,h,g){for(var _=0;;)try{return c.call(t,u,p,m,h,g)}catch(S){if(S.code==="EAGAIN"&&_<10){_++;continue}throw S}}}(t.readSync);function e(c){c.lchmod=function(u,p,m){c.open(u,je.O_WRONLY|je.O_SYMLINK,p,function(h,g){if(h){m&&m(h);return}c.fchmod(g,p,function(_){c.close(g,function(S){m&&m(_||S)})})})},c.lchmodSync=function(u,p){var m=c.openSync(u,je.O_WRONLY|je.O_SYMLINK,p),h=!0,g;try{g=c.fchmodSync(m,p),h=!1}finally{if(h)try{c.closeSync(m)}catch{}else c.closeSync(m)}return g}}function r(c){je.hasOwnProperty("O_SYMLINK")&&c.futimes?(c.lutimes=function(u,p,m,h){c.open(u,je.O_SYMLINK,function(g,_){if(g){h&&h(g);return}c.futimes(_,p,m,function(S){c.close(_,function(C){h&&h(S||C)})})})},c.lutimesSync=function(u,p,m){var h=c.openSync(u,je.O_SYMLINK),g,_=!0;try{g=c.futimesSync(h,p,m),_=!1}finally{if(_)try{c.closeSync(h)}catch{}else c.closeSync(h)}return g}):c.futimes&&(c.lutimes=function(u,p,m,h){h&&process.nextTick(h)},c.lutimesSync=function(){})}function n(c){return c&&function(u,p,m){return c.call(t,u,p,function(h){f(h)&&(h=null),m&&m.apply(this,arguments)})}}function i(c){return c&&function(u,p){try{return c.call(t,u,p)}catch(m){if(!f(m))throw m}}}function s(c){return c&&function(u,p,m,h){return c.call(t,u,p,m,function(g){f(g)&&(g=null),h&&h.apply(this,arguments)})}}function o(c){return c&&function(u,p,m){try{return c.call(t,u,p,m)}catch(h){if(!f(h))throw h}}}function a(c){return c&&function(u,p,m){typeof p=="function"&&(m=p,p=null);function h(g,_){_&&(_.uid<0&&(_.uid+=4294967296),_.gid<0&&(_.gid+=4294967296)),m&&m.apply(this,arguments)}return p?c.call(t,u,p,h):c.call(t,u,h)}}function l(c){return c&&function(u,p){var m=p?c.call(t,u,p):c.call(t,u);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}function f(c){if(!c||c.code==="ENOSYS")return!0;var u=!process.getuid||process.getuid()!==0;return!!(u&&(c.code==="EINVAL"||c.code==="EPERM"))}}});var Xi=x((Wg,Ki)=>{var Yi=v("stream").Stream;Ki.exports=pf;function pf(t){return{ReadStream:e,WriteStream:r};function e(n,i){if(!(this instanceof e))return new e(n,i);Yi.call(this);var s=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var o=Object.keys(i),a=0,l=o.length;a<l;a++){var f=o[a];this[f]=i[f]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){s._read()});return}t.open(this.path,this.flags,this.mode,function(c,u){if(c){s.emit("error",c),s.readable=!1;return}s.fd=u,s.emit("open",u),s._read()})}function r(n,i){if(!(this instanceof r))return new r(n,i);Yi.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var s=Object.keys(i),o=0,a=s.length;o<a;o++){var l=s[o];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var Qi=x((Vg,Zi)=>{"use strict";Zi.exports=df;var mf=Object.getPrototypeOf||function(t){return t.__proto__};function df(t){if(t===null||typeof t!="object")return t;if(t instanceof Object)var e={__proto__:mf(t)};else var e=Object.create(null);return Object.getOwnPropertyNames(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}});var ut=x((Hg,Sn)=>{var F=v("fs"),hf=zi(),gf=Xi(),yf=Qi(),ur=v("util"),J,mr;typeof Symbol=="function"&&typeof Symbol.for=="function"?(J=Symbol.for("graceful-fs.queue"),mr=Symbol.for("graceful-fs.previous")):(J="___graceful-fs.queue",mr="___graceful-fs.previous");function _f(){}function rs(t,e){Object.defineProperty(t,J,{get:function(){return e}})}var Qe=_f;ur.debuglog?Qe=ur.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Qe=function(){var t=ur.format.apply(ur,arguments);t="GFS4: "+t.split(/\n/).join(`
GFS4: `),console.error(t)});F[J]||(es=global[J]||[],rs(F,es),F.close=function(t){function e(r,n){return t.call(F,r,function(i){i||ts(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,mr,{value:t}),e}(F.close),F.closeSync=function(t){function e(r){t.apply(F,arguments),ts()}return Object.defineProperty(e,mr,{value:t}),e}(F.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Qe(F[J]),v("assert").equal(F[J].length,0)}));var es;global[J]||rs(global,F[J]);Sn.exports=xn(yf(F));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!F.__patched&&(Sn.exports=xn(F),F.__patched=!0);function xn(t){hf(t),t.gracefulify=xn,t.createReadStream=de,t.createWriteStream=Fe;var e=t.readFile;t.readFile=r;function r(w,b,E){return typeof b=="function"&&(E=b,b=null),B(w,b,E);function B(U,P,O,L){return e(U,P,function(I){I&&(I.code==="EMFILE"||I.code==="ENFILE")?ft([B,[U,P,O],I,L||Date.now(),Date.now()]):typeof O=="function"&&O.apply(this,arguments)})}}var n=t.writeFile;t.writeFile=i;function i(w,b,E,B){return typeof E=="function"&&(B=E,E=null),U(w,b,E,B);function U(P,O,L,I,H){return n(P,O,L,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}var s=t.appendFile;s&&(t.appendFile=o);function o(w,b,E,B){return typeof E=="function"&&(B=E,E=null),U(w,b,E,B);function U(P,O,L,I,H){return s(P,O,L,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}var a=t.copyFile;a&&(t.copyFile=l);function l(w,b,E,B){return typeof E=="function"&&(B=E,E=0),U(w,b,E,B);function U(P,O,L,I,H){return a(P,O,L,function(M){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}var f=t.readdir;t.readdir=u;var c=/^v[0-5]\./;function u(w,b,E){typeof b=="function"&&(E=b,b=null);var B=c.test(process.version)?function(O,L,I,H){return f(O,U(O,L,I,H))}:function(O,L,I,H){return f(O,L,U(O,L,I,H))};return B(w,b,E);function U(P,O,L,I){return function(H,M){H&&(H.code==="EMFILE"||H.code==="ENFILE")?ft([B,[P,O,L],H,I||Date.now(),Date.now()]):(M&&M.sort&&M.sort(),typeof L=="function"&&L.call(this,H,M))}}}if(process.version.substr(0,4)==="v0.8"){var p=gf(t);S=p.ReadStream,T=p.WriteStream}var m=t.ReadStream;m&&(S.prototype=Object.create(m.prototype),S.prototype.open=C);var h=t.WriteStream;h&&(T.prototype=Object.create(h.prototype),T.prototype.open=Y),Object.defineProperty(t,"ReadStream",{get:function(){return S},set:function(w){S=w},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WriteStream",{get:function(){return T},set:function(w){T=w},enumerable:!0,configurable:!0});var g=S;Object.defineProperty(t,"FileReadStream",{get:function(){return g},set:function(w){g=w},enumerable:!0,configurable:!0});var _=T;Object.defineProperty(t,"FileWriteStream",{get:function(){return _},set:function(w){_=w},enumerable:!0,configurable:!0});function S(w,b){return this instanceof S?(m.apply(this,arguments),this):S.apply(Object.create(S.prototype),arguments)}function C(){var w=this;ke(w.path,w.flags,w.mode,function(b,E){b?(w.autoClose&&w.destroy(),w.emit("error",b)):(w.fd=E,w.emit("open",E),w.read())})}function T(w,b){return this instanceof T?(h.apply(this,arguments),this):T.apply(Object.create(T.prototype),arguments)}function Y(){var w=this;ke(w.path,w.flags,w.mode,function(b,E){b?(w.destroy(),w.emit("error",b)):(w.fd=E,w.emit("open",E))})}function de(w,b){return new t.ReadStream(w,b)}function Fe(w,b){return new t.WriteStream(w,b)}var Ae=t.open;t.open=ke;function ke(w,b,E,B){return typeof E=="function"&&(B=E,E=null),U(w,b,E,B);function U(P,O,L,I,H){return Ae(P,O,L,function(M,lg){M&&(M.code==="EMFILE"||M.code==="ENFILE")?ft([U,[P,O,L,I],M,H||Date.now(),Date.now()]):typeof I=="function"&&I.apply(this,arguments)})}}return t}function ft(t){Qe("ENQUEUE",t[0].name,t[1]),F[J].push(t),vn()}var pr;function ts(){for(var t=Date.now(),e=0;e<F[J].length;++e)F[J][e].length>2&&(F[J][e][3]=t,F[J][e][4]=t);vn()}function vn(){if(clearTimeout(pr),pr=void 0,F[J].length!==0){var t=F[J].shift(),e=t[0],r=t[1],n=t[2],i=t[3],s=t[4];if(i===void 0)Qe("RETRY",e.name,r),e.apply(null,r);else if(Date.now()-i>=6e4){Qe("TIMEOUT",e.name,r);var o=r.pop();typeof o=="function"&&o.call(null,n)}else{var a=Date.now()-s,l=Math.max(s-i,1),f=Math.min(l*1.2,100);a>=f?(Qe("RETRY",e.name,r),e.apply(null,r.concat([i]))):F[J].push(t)}pr===void 0&&(pr=setTimeout(vn,0))}}});var Q=x(Ce=>{"use strict";var ns=q().fromCallback,Z=ut(),wf=["access","appendFile","chmod","chown","close","copyFile","cp","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","glob","lchmod","lchown","lutimes","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","statfs","symlink","truncate","unlink","utimes","writeFile"].filter(t=>typeof Z[t]=="function");Object.assign(Ce,Z);wf.forEach(t=>{Ce[t]=ns(Z[t])});Ce.exists=function(t,e){return typeof e=="function"?Z.exists(t,e):new Promise(r=>Z.exists(t,r))};Ce.read=function(t,e,r,n,i,s){return typeof s=="function"?Z.read(t,e,r,n,i,s):new Promise((o,a)=>{Z.read(t,e,r,n,i,(l,f,c)=>{if(l)return a(l);o({bytesRead:f,buffer:c})})})};Ce.write=function(t,e,...r){return typeof r[r.length-1]=="function"?Z.write(t,e,...r):new Promise((n,i)=>{Z.write(t,e,...r,(s,o,a)=>{if(s)return i(s);n({bytesWritten:o,buffer:a})})})};Ce.readv=function(t,e,...r){return typeof r[r.length-1]=="function"?Z.readv(t,e,...r):new Promise((n,i)=>{Z.readv(t,e,...r,(s,o,a)=>{if(s)return i(s);n({bytesRead:o,buffers:a})})})};Ce.writev=function(t,e,...r){return typeof r[r.length-1]=="function"?Z.writev(t,e,...r):new Promise((n,i)=>{Z.writev(t,e,...r,(s,o,a)=>{if(s)return i(s);n({bytesWritten:o,buffers:a})})})};typeof Z.realpath.native=="function"?Ce.realpath.native=ns(Z.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var ss=x((Jg,is)=>{"use strict";var xf=v("path");is.exports.checkPath=function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(xf.parse(e).root,""))){let n=new Error(`Path contains invalid characters: ${e}`);throw n.code="EINVAL",n}}});var ls=x((zg,bn)=>{"use strict";var os=Q(),{checkPath:as}=ss(),cs=t=>{let e={mode:511};return typeof t=="number"?t:{...e,...t}.mode};bn.exports.makeDir=async(t,e)=>(as(t),os.mkdir(t,{mode:cs(e),recursive:!0}));bn.exports.makeDirSync=(t,e)=>(as(t),os.mkdirSync(t,{mode:cs(e),recursive:!0}))});var ge=x((Yg,fs)=>{"use strict";var vf=q().fromPromise,{makeDir:Sf,makeDirSync:En}=ls(),Pn=vf(Sf);fs.exports={mkdirs:Pn,mkdirsSync:En,mkdirp:Pn,mkdirpSync:En,ensureDir:Pn,ensureDirSync:En}});var Ue=x((Kg,ps)=>{"use strict";var bf=q().fromPromise,us=Q();function Ef(t){return us.access(t).then(()=>!0).catch(()=>!1)}ps.exports={pathExists:bf(Ef),pathExistsSync:us.existsSync}});var kn=x((Xg,ms)=>{"use strict";var pt=Q(),Pf=q().fromPromise;async function kf(t,e,r){let n=await pt.open(t,"r+"),i=null;try{await pt.futimes(n,e,r)}finally{try{await pt.close(n)}catch(s){i=s}}if(i)throw i}function Cf(t,e,r){let n=pt.openSync(t,"r+");return pt.futimesSync(n,e,r),pt.closeSync(n)}ms.exports={utimesMillis:Pf(kf),utimesMillisSync:Cf}});var et=x((Zg,ys)=>{"use strict";var mt=Q(),W=v("path"),ds=q().fromPromise;function Of(t,e,r){let n=r.dereference?i=>mt.stat(i,{bigint:!0}):i=>mt.lstat(i,{bigint:!0});return Promise.all([n(t),n(e).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,s])=>({srcStat:i,destStat:s}))}function Lf(t,e,r){let n,i=r.dereference?o=>mt.statSync(o,{bigint:!0}):o=>mt.lstatSync(o,{bigint:!0}),s=i(t);try{n=i(e)}catch(o){if(o.code==="ENOENT")return{srcStat:s,destStat:null};throw o}return{srcStat:s,destStat:n}}async function Nf(t,e,r,n){let{srcStat:i,destStat:s}=await Of(t,e,n);if(s){if(Tt(i,s)){let o=W.basename(t),a=W.basename(e);if(r==="move"&&o!==a&&o.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&Cn(t,e))throw new Error(dr(t,e,r));return{srcStat:i,destStat:s}}function Tf(t,e,r,n){let{srcStat:i,destStat:s}=Lf(t,e,n);if(s){if(Tt(i,s)){let o=W.basename(t),a=W.basename(e);if(r==="move"&&o!==a&&o.toLowerCase()===a.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&Cn(t,e))throw new Error(dr(t,e,r));return{srcStat:i,destStat:s}}async function hs(t,e,r,n){let i=W.resolve(W.dirname(t)),s=W.resolve(W.dirname(r));if(s===i||s===W.parse(s).root)return;let o;try{o=await mt.stat(s,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(Tt(e,o))throw new Error(dr(t,r,n));return hs(t,e,s,n)}function gs(t,e,r,n){let i=W.resolve(W.dirname(t)),s=W.resolve(W.dirname(r));if(s===i||s===W.parse(s).root)return;let o;try{o=mt.statSync(s,{bigint:!0})}catch(a){if(a.code==="ENOENT")return;throw a}if(Tt(e,o))throw new Error(dr(t,r,n));return gs(t,e,s,n)}function Tt(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}function Cn(t,e){let r=W.resolve(t).split(W.sep).filter(i=>i),n=W.resolve(e).split(W.sep).filter(i=>i);return r.every((i,s)=>n[s]===i)}function dr(t,e,r){return`Cannot ${r} '${t}' to a subdirectory of itself, '${e}'.`}ys.exports={checkPaths:ds(Nf),checkPathsSync:Tf,checkParentPaths:ds(hs),checkParentPathsSync:gs,isSrcSubdir:Cn,areIdentical:Tt}});var Ss=x((Qg,vs)=>{"use strict";var K=Q(),It=v("path"),{mkdirs:If}=ge(),{pathExists:Mf}=Ue(),{utimesMillis:Df}=kn(),Mt=et();async function Ff(t,e,r={}){typeof r=="function"&&(r={filter:r}),r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001");let{srcStat:n,destStat:i}=await Mt.checkPaths(t,e,"copy",r);if(await Mt.checkParentPaths(t,n,e,"copy"),!await ws(t,e,r))return;let o=It.dirname(e);await Mf(o)||await If(o),await xs(i,t,e,r)}async function ws(t,e,r){return r.filter?r.filter(t,e):!0}async function xs(t,e,r,n){let s=await(n.dereference?K.stat:K.lstat)(e);if(s.isDirectory())return Bf(s,t,e,r,n);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return Af(s,t,e,r,n);if(s.isSymbolicLink())return jf(t,e,r,n);throw s.isSocket()?new Error(`Cannot copy a socket file: ${e}`):s.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}async function Af(t,e,r,n,i){if(!e)return _s(t,r,n,i);if(i.overwrite)return await K.unlink(n),_s(t,r,n,i);if(i.errorOnExist)throw new Error(`'${n}' already exists`)}async function _s(t,e,r,n){if(await K.copyFile(e,r),n.preserveTimestamps){$f(t.mode)&&await Rf(r,t.mode);let i=await K.stat(e);await Df(r,i.atime,i.mtime)}return K.chmod(r,t.mode)}function $f(t){return(t&128)===0}function Rf(t,e){return K.chmod(t,e|128)}async function Bf(t,e,r,n,i){e||await K.mkdir(n);let s=[];for await(let o of await K.opendir(r)){let a=It.join(r,o.name),l=It.join(n,o.name);s.push(ws(a,l,i).then(f=>{if(f)return Mt.checkPaths(a,l,"copy",i).then(({destStat:c})=>xs(c,a,l,i))}))}await Promise.all(s),e||await K.chmod(n,t.mode)}async function jf(t,e,r,n){let i=await K.readlink(e);if(n.dereference&&(i=It.resolve(process.cwd(),i)),!t)return K.symlink(i,r);let s=null;try{s=await K.readlink(r)}catch(o){if(o.code==="EINVAL"||o.code==="UNKNOWN")return K.symlink(i,r);throw o}if(n.dereference&&(s=It.resolve(process.cwd(),s)),Mt.isSrcSubdir(i,s))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${s}'.`);if(Mt.isSrcSubdir(s,i))throw new Error(`Cannot overwrite '${s}' with '${i}'.`);return await K.unlink(r),K.symlink(i,r)}vs.exports=Ff});var Cs=x((ey,ks)=>{"use strict";var ee=ut(),Dt=v("path"),Uf=ge().mkdirsSync,qf=kn().utimesMillisSync,Ft=et();function Wf(t,e,r){typeof r=="function"&&(r={filter:r}),r=r||{},r.clobber="clobber"in r?!!r.clobber:!0,r.overwrite="overwrite"in r?!!r.overwrite:r.clobber,r.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:n,destStat:i}=Ft.checkPathsSync(t,e,"copy",r);if(Ft.checkParentPathsSync(t,n,e,"copy"),r.filter&&!r.filter(t,e))return;let s=Dt.dirname(e);return ee.existsSync(s)||Uf(s),bs(i,t,e,r)}function bs(t,e,r,n){let s=(n.dereference?ee.statSync:ee.lstatSync)(e);if(s.isDirectory())return Kf(s,t,e,r,n);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return Vf(s,t,e,r,n);if(s.isSymbolicLink())return Qf(t,e,r,n);throw s.isSocket()?new Error(`Cannot copy a socket file: ${e}`):s.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}function Vf(t,e,r,n,i){return e?Hf(t,r,n,i):Es(t,r,n,i)}function Hf(t,e,r,n){if(n.overwrite)return ee.unlinkSync(r),Es(t,e,r,n);if(n.errorOnExist)throw new Error(`'${r}' already exists`)}function Es(t,e,r,n){return ee.copyFileSync(e,r),n.preserveTimestamps&&Gf(t.mode,e,r),On(r,t.mode)}function Gf(t,e,r){return Jf(t)&&zf(r,t),Yf(e,r)}function Jf(t){return(t&128)===0}function zf(t,e){return On(t,e|128)}function On(t,e){return ee.chmodSync(t,e)}function Yf(t,e){let r=ee.statSync(t);return qf(e,r.atime,r.mtime)}function Kf(t,e,r,n,i){return e?Ps(r,n,i):Xf(t.mode,r,n,i)}function Xf(t,e,r,n){return ee.mkdirSync(r),Ps(e,r,n),On(r,t)}function Ps(t,e,r){let n=ee.opendirSync(t);try{let i;for(;(i=n.readSync())!==null;)Zf(i.name,t,e,r)}finally{n.closeSync()}}function Zf(t,e,r,n){let i=Dt.join(e,t),s=Dt.join(r,t);if(n.filter&&!n.filter(i,s))return;let{destStat:o}=Ft.checkPathsSync(i,s,"copy",n);return bs(o,i,s,n)}function Qf(t,e,r,n){let i=ee.readlinkSync(e);if(n.dereference&&(i=Dt.resolve(process.cwd(),i)),t){let s;try{s=ee.readlinkSync(r)}catch(o){if(o.code==="EINVAL"||o.code==="UNKNOWN")return ee.symlinkSync(i,r);throw o}if(n.dereference&&(s=Dt.resolve(process.cwd(),s)),Ft.isSrcSubdir(i,s))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${s}'.`);if(Ft.isSrcSubdir(s,i))throw new Error(`Cannot overwrite '${s}' with '${i}'.`);return eu(i,r)}else return ee.symlinkSync(i,r)}function eu(t,e){return ee.unlinkSync(e),ee.symlinkSync(t,e)}ks.exports=Wf});var hr=x((ty,Os)=>{"use strict";var tu=q().fromPromise;Os.exports={copy:tu(Ss()),copySync:Cs()}});var At=x((ry,Ns)=>{"use strict";var Ls=ut(),ru=q().fromCallback;function nu(t,e){Ls.rm(t,{recursive:!0,force:!0},e)}function iu(t){Ls.rmSync(t,{recursive:!0,force:!0})}Ns.exports={remove:ru(nu),removeSync:iu}});var Rs=x((ny,$s)=>{"use strict";var su=q().fromPromise,Ms=Q(),Ds=v("path"),Fs=ge(),As=At(),Ts=su(async function(e){let r;try{r=await Ms.readdir(e)}catch{return Fs.mkdirs(e)}return Promise.all(r.map(n=>As.remove(Ds.join(e,n))))});function Is(t){let e;try{e=Ms.readdirSync(t)}catch{return Fs.mkdirsSync(t)}e.forEach(r=>{r=Ds.join(t,r),As.removeSync(r)})}$s.exports={emptyDirSync:Is,emptydirSync:Is,emptyDir:Ts,emptydir:Ts}});var qs=x((iy,Us)=>{"use strict";var ou=q().fromPromise,Bs=v("path"),Oe=Q(),js=ge();async function au(t){let e;try{e=await Oe.stat(t)}catch{}if(e&&e.isFile())return;let r=Bs.dirname(t),n=null;try{n=await Oe.stat(r)}catch(i){if(i.code==="ENOENT"){await js.mkdirs(r),await Oe.writeFile(t,"");return}else throw i}n.isDirectory()?await Oe.writeFile(t,""):await Oe.readdir(r)}function cu(t){let e;try{e=Oe.statSync(t)}catch{}if(e&&e.isFile())return;let r=Bs.dirname(t);try{Oe.statSync(r).isDirectory()||Oe.readdirSync(r)}catch(n){if(n&&n.code==="ENOENT")js.mkdirsSync(r);else throw n}Oe.writeFileSync(t,"")}Us.exports={createFile:ou(au),createFileSync:cu}});var Js=x((sy,Gs)=>{"use strict";var lu=q().fromPromise,Ws=v("path"),qe=Q(),Vs=ge(),{pathExists:fu}=Ue(),{areIdentical:Hs}=et();async function uu(t,e){let r;try{r=await qe.lstat(e)}catch{}let n;try{n=await qe.lstat(t)}catch(o){throw o.message=o.message.replace("lstat","ensureLink"),o}if(r&&Hs(n,r))return;let i=Ws.dirname(e);await fu(i)||await Vs.mkdirs(i),await qe.link(t,e)}function pu(t,e){let r;try{r=qe.lstatSync(e)}catch{}try{let s=qe.lstatSync(t);if(r&&Hs(s,r))return}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let n=Ws.dirname(e);return qe.existsSync(n)||Vs.mkdirsSync(n),qe.linkSync(t,e)}Gs.exports={createLink:lu(uu),createLinkSync:pu}});var Ys=x((oy,zs)=>{"use strict";var We=v("path"),$t=Q(),{pathExists:mu}=Ue(),du=q().fromPromise;async function hu(t,e){if(We.isAbsolute(t)){try{await $t.lstat(t)}catch(s){throw s.message=s.message.replace("lstat","ensureSymlink"),s}return{toCwd:t,toDst:t}}let r=We.dirname(e),n=We.join(r,t);if(await mu(n))return{toCwd:n,toDst:t};try{await $t.lstat(t)}catch(s){throw s.message=s.message.replace("lstat","ensureSymlink"),s}return{toCwd:t,toDst:We.relative(r,t)}}function gu(t,e){if(We.isAbsolute(t)){if(!$t.existsSync(t))throw new Error("absolute srcpath does not exist");return{toCwd:t,toDst:t}}let r=We.dirname(e),n=We.join(r,t);if($t.existsSync(n))return{toCwd:n,toDst:t};if(!$t.existsSync(t))throw new Error("relative srcpath does not exist");return{toCwd:t,toDst:We.relative(r,t)}}zs.exports={symlinkPaths:du(hu),symlinkPathsSync:gu}});var Zs=x((ay,Xs)=>{"use strict";var Ks=Q(),yu=q().fromPromise;async function _u(t,e){if(e)return e;let r;try{r=await Ks.lstat(t)}catch{return"file"}return r&&r.isDirectory()?"dir":"file"}function wu(t,e){if(e)return e;let r;try{r=Ks.lstatSync(t)}catch{return"file"}return r&&r.isDirectory()?"dir":"file"}Xs.exports={symlinkType:yu(_u),symlinkTypeSync:wu}});var ro=x((cy,to)=>{"use strict";var xu=q().fromPromise,Qs=v("path"),Se=Q(),{mkdirs:vu,mkdirsSync:Su}=ge(),{symlinkPaths:bu,symlinkPathsSync:Eu}=Ys(),{symlinkType:Pu,symlinkTypeSync:ku}=Zs(),{pathExists:Cu}=Ue(),{areIdentical:eo}=et();async function Ou(t,e,r){let n;try{n=await Se.lstat(e)}catch{}if(n&&n.isSymbolicLink()){let[a,l]=await Promise.all([Se.stat(t),Se.stat(e)]);if(eo(a,l))return}let i=await bu(t,e);t=i.toDst;let s=await Pu(i.toCwd,r),o=Qs.dirname(e);return await Cu(o)||await vu(o),Se.symlink(t,e,s)}function Lu(t,e,r){let n;try{n=Se.lstatSync(e)}catch{}if(n&&n.isSymbolicLink()){let a=Se.statSync(t),l=Se.statSync(e);if(eo(a,l))return}let i=Eu(t,e);t=i.toDst,r=ku(i.toCwd,r);let s=Qs.dirname(e);return Se.existsSync(s)||Su(s),Se.symlinkSync(t,e,r)}to.exports={createSymlink:xu(Ou),createSymlinkSync:Lu}});var fo=x((ly,lo)=>{"use strict";var{createFile:no,createFileSync:io}=qs(),{createLink:so,createLinkSync:oo}=Js(),{createSymlink:ao,createSymlinkSync:co}=ro();lo.exports={createFile:no,createFileSync:io,ensureFile:no,ensureFileSync:io,createLink:so,createLinkSync:oo,ensureLink:so,ensureLinkSync:oo,createSymlink:ao,createSymlinkSync:co,ensureSymlink:ao,ensureSymlinkSync:co}});var gr=x((fy,uo)=>{function Nu(t,{EOL:e=`
`,finalEOL:r=!0,replacer:n=null,spaces:i}={}){let s=r?e:"";return JSON.stringify(t,n,i).replace(/\n/g,e)+s}function Tu(t){return Buffer.isBuffer(t)&&(t=t.toString("utf8")),t.replace(/^\uFEFF/,"")}uo.exports={stringify:Nu,stripBom:Tu}});var go=x((uy,ho)=>{var dt;try{dt=ut()}catch{dt=v("fs")}var yr=q(),{stringify:po,stripBom:mo}=gr();async function Iu(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||dt,n="throws"in e?e.throws:!0,i=await yr.fromCallback(r.readFile)(t,e);i=mo(i);let s;try{s=JSON.parse(i,e?e.reviver:null)}catch(o){if(n)throw o.message=`${t}: ${o.message}`,o;return null}return s}var Mu=yr.fromPromise(Iu);function Du(t,e={}){typeof e=="string"&&(e={encoding:e});let r=e.fs||dt,n="throws"in e?e.throws:!0;try{let i=r.readFileSync(t,e);return i=mo(i),JSON.parse(i,e.reviver)}catch(i){if(n)throw i.message=`${t}: ${i.message}`,i;return null}}async function Fu(t,e,r={}){let n=r.fs||dt,i=po(e,r);await yr.fromCallback(n.writeFile)(t,i,r)}var Au=yr.fromPromise(Fu);function $u(t,e,r={}){let n=r.fs||dt,i=po(e,r);return n.writeFileSync(t,i,r)}var Ru={readFile:Mu,readFileSync:Du,writeFile:Au,writeFileSync:$u};ho.exports=Ru});var _o=x((py,yo)=>{"use strict";var _r=go();yo.exports={readJson:_r.readFile,readJsonSync:_r.readFileSync,writeJson:_r.writeFile,writeJsonSync:_r.writeFileSync}});var wr=x((my,vo)=>{"use strict";var Bu=q().fromPromise,Ln=Q(),wo=v("path"),xo=ge(),ju=Ue().pathExists;async function Uu(t,e,r="utf-8"){let n=wo.dirname(t);return await ju(n)||await xo.mkdirs(n),Ln.writeFile(t,e,r)}function qu(t,...e){let r=wo.dirname(t);Ln.existsSync(r)||xo.mkdirsSync(r),Ln.writeFileSync(t,...e)}vo.exports={outputFile:Bu(Uu),outputFileSync:qu}});var bo=x((dy,So)=>{"use strict";var{stringify:Wu}=gr(),{outputFile:Vu}=wr();async function Hu(t,e,r={}){let n=Wu(e,r);await Vu(t,n,r)}So.exports=Hu});var Po=x((hy,Eo)=>{"use strict";var{stringify:Gu}=gr(),{outputFileSync:Ju}=wr();function zu(t,e,r){let n=Gu(e,r);Ju(t,n,r)}Eo.exports=zu});var Co=x((gy,ko)=>{"use strict";var Yu=q().fromPromise,te=_o();te.outputJson=Yu(bo());te.outputJsonSync=Po();te.outputJSON=te.outputJson;te.outputJSONSync=te.outputJsonSync;te.writeJSON=te.writeJson;te.writeJSONSync=te.writeJsonSync;te.readJSON=te.readJson;te.readJSONSync=te.readJsonSync;ko.exports=te});var Io=x((yy,To)=>{"use strict";var Ku=Q(),Oo=v("path"),{copy:Xu}=hr(),{remove:No}=At(),{mkdirp:Zu}=ge(),{pathExists:Qu}=Ue(),Lo=et();async function ep(t,e,r={}){let n=r.overwrite||r.clobber||!1,{srcStat:i,isChangingCase:s=!1}=await Lo.checkPaths(t,e,"move",r);await Lo.checkParentPaths(t,i,e,"move");let o=Oo.dirname(e);return Oo.parse(o).root!==o&&await Zu(o),tp(t,e,n,s)}async function tp(t,e,r,n){if(!n){if(r)await No(e);else if(await Qu(e))throw new Error("dest already exists.")}try{await Ku.rename(t,e)}catch(i){if(i.code!=="EXDEV")throw i;await rp(t,e,r)}}async function rp(t,e,r){return await Xu(t,e,{overwrite:r,errorOnExist:!0,preserveTimestamps:!0}),No(t)}To.exports=ep});var $o=x((_y,Ao)=>{"use strict";var Do=ut(),Tn=v("path"),np=hr().copySync,Fo=At().removeSync,ip=ge().mkdirpSync,Mo=et();function sp(t,e,r){r=r||{};let n=r.overwrite||r.clobber||!1,{srcStat:i,isChangingCase:s=!1}=Mo.checkPathsSync(t,e,"move",r);return Mo.checkParentPathsSync(t,i,e,"move"),op(e)||ip(Tn.dirname(e)),ap(t,e,n,s)}function op(t){let e=Tn.dirname(t);return Tn.parse(e).root===e}function ap(t,e,r,n){if(n)return Nn(t,e,r);if(r)return Fo(e),Nn(t,e,r);if(Do.existsSync(e))throw new Error("dest already exists.");return Nn(t,e,r)}function Nn(t,e,r){try{Do.renameSync(t,e)}catch(n){if(n.code!=="EXDEV")throw n;return cp(t,e,r)}}function cp(t,e,r){return np(t,e,{overwrite:r,errorOnExist:!0,preserveTimestamps:!0}),Fo(t)}Ao.exports=sp});var Bo=x((wy,Ro)=>{"use strict";var lp=q().fromPromise;Ro.exports={move:lp(Io()),moveSync:$o()}});var z=x((xy,jo)=>{"use strict";jo.exports={...Q(),...hr(),...Rs(),...fo(),...Co(),...ge(),...Bo(),...wr(),...Ue(),...At()}});var Uo,qo=y(()=>{Uo=()=>`
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

#cache
.turbo
.next
.vercel

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*


# local env files
.env*

out/
build/
dist/

# plasmo - https://www.plasmo.com
.plasmo

# bpp - https://github.com/marketplace/actions/browser-platform-publisher
keys.json

# typescript
.tsbuildinfo
`});import{userInfo as fp}from"os";import{sentenceCase as up}from"change-case";import pp from"package-json";var mp,Wo,In,Mn=y(()=>{mp=async({name:t="plasmo-extension",version:e="0.0.1",packageManager:r={}})=>{let n={name:t,displayName:up(t),version:e,description:"A basic Plasmo extension.",author:fp().username,packageManager:void 0,scripts:{dev:"plasmo dev",build:"plasmo build",package:"plasmo package"},dependencies:{plasmo:"workspace:*",react:"*","react-dom":"*"},devDependencies:{"@types/chrome":"*","@types/node":"*","@types/react":"*","@types/react-dom":"*",prettier:"*",typescript:"*"},manifest:{host_permissions:["https://*/*"]}};return!r||!r.version?delete n.packageManager:n.packageManager=`${r.name}@${r.version}`,n},Wo=async t=>await mp(t),In=async t=>{let e={};return await Promise.all(Object.entries(t).map(async([r,n])=>{if(r==="plasmo")e[r]="0.90.5";else if(n==="workspace:*")try{let i=await pp(r,{version:"latest"});e[r]=i.version}catch{e[r]=n}else e[r]=n})),e}});import{dirname as dp,resolve as ht}from"path";import{fileURLToPath as hp}from"url";var xr,Dn=y(()=>{xr=()=>{let t=dp(hp(import.meta.url)),e=ht(t,"..","templates"),r=ht(e,"static"),n=ht(v.resolve("@plasmohq/init"),".."),i=ht(n,"templates"),s=ht(n,"entries"),o=ht(n,"bpp.yml");return{templatePath:e,initTemplatePath:i,initEntryPath:s,staticTemplatePath:r,bppYaml:o}}});import gp from"inquirer";var gt,Fn=y(()=>{gt=async(t="",e="")=>{let{data:r}=await gp.prompt({name:"data",prefix:"\u{1F7E1}",message:t,default:e});return r}});import{readFile as yp}from"fs/promises";import{extname as _p}from"path";import{strFromU8 as wp,unzipSync as xp}from"fflate";async function vp(t,e,r){if(t.content_security_policy&&(d("Convert content_security_policy"),e.manifest.content_security_policy={extension_pages:t.content_security_policy}),t.web_accessible_resources&&(d("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[{matches:["https://*/*"],resources:t.web_accessible_resources}]),t.permissions){d("Convert permissions"),e.manifest.permissions=[],e.manifest.host_permissions=[];for(let n of t.permissions)n.startsWith("http")||n==="<all_urls>"?e.manifest.host_permissions.push(n):e.manifest.permissions.push(n)}t.browser_action&&(d("Convert browser_action"),e.manifest.action={default_title:t.browser_action.default_title}),t.background&&d("Convert background")}async function Sp(t,e,r){t.content_security_policy&&(d("Convert content_security_policy"),e.manifest.content_security_policy={...t.content_security_policy}),t.web_accessible_resources&&(d("Convert web_accessible_resources"),e.manifest.web_accessible_resources=[...t.web_accessible_resources]),t.permissions&&(d("Transfer permissions"),e.manifest.permissions=[...t.permissions]),t.host_permissions&&(d("Transfer host_permissions"),e.manifest.host_permissions=[...t.host_permissions]),t.action&&(d("Convert browser_action"),e.manifest.action={default_title:t.action.default_title}),t.background&&d("Convert background")}var Vo,Ho,Go,Jo=y(()=>{Vo=$(z(),1);k();Mn();Ho=async t=>{let e={unzipped:{},isZip:!1,manifestData:{}},r=_p(t);if(r===".zip"){let n=await yp(t);e.unzipped=xp(n),e.isZip=!0,e.manifestData=JSON.parse(wp(e.unzipped["manifest.json"]))}else if(r===".json")e.manifestData=await(0,Vo.readJson)(t);else return null;return e},Go=async(t,e,{manifestData:r})=>{let n=await Wo({name:t.packageName,packageManager:e});switch(n.version=r.version,n.displayName=r.name,n.description=r.description,r?.author&&(n.author=r.author),r.homepage_url&&(n.homepage=r.homepage_url),r.version_name&&(n.manifest.version_name=r.version_name),r.browser_specific_settings&&(n.manifest.browser_specific_settings=r.browser_specific_settings),r.default_locale&&d("Convert locale"),r.options_ui&&d("Convert options_ui"),r.chrome_url_overrides&&d("Convert chrome_url_overrides"),r.icons&&d("Convert icons"),r.content_scripts&&d("Convert content_scripts"),r.manifest_version){case 2:await vp(r,n,t);break;case 3:await Sp(r,n,t);break;default:throw new Error("Unknown manifest version")}return n}});import{existsSync as zo}from"fs";import{lstat as bp,readFile as Ep,writeFile as Pp}from"fs/promises";import{isAbsolute as kp,join as Cp,relative as Op,resolve as Rt}from"path";import Lp from"@expo/spawn-async";import{sentenceCase as Np}from"change-case";import Tp from"ignore";import{temporaryDirectory as Ip}from"tempy";var ye,Mp,vr,Yo=y(()=>{ye=$(z(),1);he();X();k();qo();Mn();Dn();Fn();Jo();Mp=/(?:^--with-)(?:\w+-?)+(?:[^-]$)/,vr=class{constructor(e,r,n=!1){this.commonPath=e;this.packageManager=r;this.isExample=n}templatePath=xr();async create(){return await this.createFrom()||await this.createWith()||await this.createBlank()}async createFrom(){let e=G("--from");if(!e)return!1;let r=kp(e)?e:Rt(e),n=await bp(r);return n.isFile()?await this.createFromManifest(r):n.isDirectory()?await this.createFromLocalTemplate(r):!1}async createFromLocalTemplate(e){let r=Tp().add(["node_modules",".git",".env*"]),n=Cp(e,".gitignore");if(await A(n)){let o=await Ep(n,"utf-8");r.add(o)}await(0,ye.copy)(e,this.commonPath.projectDirectory,{filter:o=>o===e||!r.ignores(Op(e,o))});let s=await(0,ye.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(s),N(`Creating new project from ${e}`),!0}async createFromManifest(e){let r=await Ho(e);if(r===null)return!1;await this.copyBlankInitFiles();let n=await Go(this.commonPath,this.packageManager,r);return await this.outputPackageData(n,{resolveWorkspaceRefs:!0}),!0}async createWith(){let e=process.argv.find(r=>Mp.test(r));return e===void 0?!1:this.createWithExample(e.substring(2))}async createWithExample(e){let r=Ip();d(`Download examples to temporary directory: ${r}`);try{await Lp("git",["clone","--depth","1","https://github.com/PlasmoHQ/examples.git","."],{cwd:r,ignoreStdio:!0})}catch(s){if(s.code==="ENOENT")throw new Error("Unable to clone example repo. `git` is not in PATH.")}let n=Rt(r,e);if(!zo(n))throw new Error(`Example ${e} not found. You may file an example request at: https://docs.plasmo.com/exp`);d("Copy example to project directory"),await Promise.all([(0,ye.copy)(n,this.commonPath.projectDirectory),this.copyBppWorkflow()]);let i=await(0,ye.readJson)(this.commonPath.packageFilePath);return await this.outputPackageData(i,{resolveWorkspaceRefs:!0}),N(`Creating new project ${e.split("-").join(" ")}`),!0}async createBlank(){return await this.createWithExample("with-popup"),!0}async outputPackageData(e,{resolveWorkspaceRefs:r=!1}={}){let{packageName:n,packageFilePath:i}=this.commonPath;if(e.name=n,e.displayName=Np(n),e.description=await gt("Extension description:",e.description),this.isExample)delete e.packageManager,e.contributors=[await gt("Contributor name:",e.author)],e.author="Plasmo Corp. <foss@plasmo.com>";else if(delete e.contributors,e.author=await gt("Author name:",e.author),r){d("Replace workspace refs with the latest package version from npm registry");let s=await Promise.all([In(e.dependencies),In(e.devDependencies)]);e.dependencies=s[0],e.devDependencies=s[1]}await(0,ye.outputJson)(i,e,{spaces:2})}async copyBlankInitFiles(){let r=(G("--entry")||"popup").split(new RegExp(",|\\s")).flatMap(n=>[`${n}.ts`,`${n}.tsx`]).map(n=>[Rt(this.templatePath.initEntryPath,n),Rt(this.commonPath.projectDirectory,n)]).filter(([n])=>zo(n));d("Using the following entry files: ",r),await Promise.all([(0,ye.copy)(this.templatePath.initTemplatePath,this.commonPath.projectDirectory),this.copyBppWorkflow(),Pp(this.commonPath.gitIgnorePath,Uo())]),await Promise.all(r.map(([n,i])=>(0,ye.copy)(n,i)))}async copyBppWorkflow(){if(this.isExample||R("--no-bpp"))return;d("Copying BPP workflow...");let e=Rt(this.commonPath.projectDirectory,".github","workflows","submit.yml");return(0,ye.copy)(this.templatePath.bppYaml,e)}}});import{createQuestId as Dp}from"mnemonic-id";var Ko,Xo=y(()=>{nr();k();Fn();Ko=async()=>{let[t]=rr("init");return t?(d("Using user-provided name:",t),t):(d("Prompting for the extension name"),await gt("Extension name:",Dp()))}});import Sr from"@expo/spawn-async";async function Zo(t,e){if(!await A(t.gitIgnorePath))return!1;try{return await Fp(e)}catch(r){return j(r.message),!1}}var Fp,Qo=y(()=>{X();k();Fp=async t=>{let{default:e}=await import("chalk"),r={cwd:t,ignoreStdio:!0};try{return d("Checking if the root is a git repository"),await Sr("git",["rev-parse","--is-inside-work-tree"],r),d(`${t} is a git repository, bailing ${e.bold("git init")}`),!1}catch(n){if(n.code==="ENOENT")throw new Error("Unable to initialize git repo. `git` not in PATH.")}return N("Initializing git project..."),await Sr("git",["init"],r),await Sr("git",["add","--all"],r),await Sr("git",["commit","-m","Created a new Plasmo extension"],r),d("Added all files to git and created the initial commit."),!0}});import Ap from"@expo/spawn-async";var ea,ta=y(()=>{k();ea=async(t,e)=>{try{N("Installing dependencies..."),await Ap(e.name,["install"],{cwd:t,stdio:"inherit"})}catch(r){j(r.message)}}});var ra,na=y(()=>{k();ra=async(t,e,r,n)=>{let{default:i}=await import("chalk");Re("Your extension is ready in: ",i.yellowBright(t),`

    To start hacking, run:

`,t===e?"":`      cd ${r.packageName}
`,`      ${n.name} ${n.name==="npm"?"run dev":"dev"}
`,`
    Visit https://docs.plasmo.com for documentation and more examples.`)}});var ia={};Xe(ia,{default:()=>Up});import{resolve as $p}from"path";import{cwd as Rp}from"process";import{kebabCase as Bp}from"change-case";async function jp(){fe();let t=R("--exp"),e=await Ko(),r=Rp(),n=$p(r,Bp(e)||e);d("Project directory:",n);let i=ct(n);if(d("Package name:",i.packageName),t&&!i.packageName.startsWith("with-"))throw new Error("Example extensions must have the `with-` prefix");await Gi(n);let s=await lt();d(`Using package manager: ${s.name} ${s?.version}`),await new vr(i,s,t).create(),await ea(n,s),await Zo(i,n),await ra(n,r,i,s)}var Up,sa=y(()=>{he();X();k();cr();lr();Ze();Yo();Xo();Qo();ta();na();Up=jp});var Le=x((O_,ca)=>{"use strict";var oa=["nodebuffer","arraybuffer","fragments"],aa=typeof Blob<"u";aa&&oa.push("blob");ca.exports={BINARY_TYPES:oa,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:aa,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Bt=x((L_,br)=>{"use strict";var{EMPTY_BUFFER:qp}=Le(),An=Buffer[Symbol.species];function Wp(t,e){if(t.length===0)return qp;if(t.length===1)return t[0];let r=Buffer.allocUnsafe(e),n=0;for(let i=0;i<t.length;i++){let s=t[i];r.set(s,n),n+=s.length}return n<e?new An(r.buffer,r.byteOffset,n):r}function la(t,e,r,n,i){for(let s=0;s<i;s++)r[n+s]=t[s]^e[s&3]}function fa(t,e){for(let r=0;r<t.length;r++)t[r]^=e[r&3]}function Vp(t){return t.length===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.length)}function $n(t){if($n.readOnly=!0,Buffer.isBuffer(t))return t;let e;return t instanceof ArrayBuffer?e=new An(t):ArrayBuffer.isView(t)?e=new An(t.buffer,t.byteOffset,t.byteLength):(e=Buffer.from(t),$n.readOnly=!1),e}br.exports={concat:Wp,mask:la,toArrayBuffer:Vp,toBuffer:$n,unmask:fa};if(!process.env.WS_NO_BUFFER_UTIL)try{let t=v("bufferutil");br.exports.mask=function(e,r,n,i,s){s<48?la(e,r,n,i,s):t.mask(e,r,n,i,s)},br.exports.unmask=function(e,r){e.length<32?fa(e,r):t.unmask(e,r)}}catch{}});var ma=x((N_,pa)=>{"use strict";var ua=Symbol("kDone"),Rn=Symbol("kRun"),Bn=class{constructor(e){this[ua]=()=>{this.pending--,this[Rn]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Rn]()}[Rn](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[ua])}}};pa.exports=Bn});var qt=x((T_,ya)=>{"use strict";var jt=v("zlib"),da=Bt(),Hp=ma(),{kStatusCode:ha}=Le(),Gp=Buffer[Symbol.species],Jp=Buffer.from([0,0,255,255]),kr=Symbol("permessage-deflate"),Ne=Symbol("total-length"),Ut=Symbol("callback"),Ve=Symbol("buffers"),Pr=Symbol("error"),Er,jn=class{constructor(e,r,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!r,this._deflate=null,this._inflate=null,this.params=null,!Er){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;Er=new Hp(i)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Ut];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let r=this._options,n=e.find(i=>!(r.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(r.serverMaxWindowBits===!1||typeof r.serverMaxWindowBits=="number"&&r.serverMaxWindowBits>i.server_max_window_bits)||typeof r.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return r.serverNoContextTakeover&&(n.server_no_context_takeover=!0),r.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof r.serverMaxWindowBits=="number"&&(n.server_max_window_bits=r.serverMaxWindowBits),typeof r.clientMaxWindowBits=="number"?n.client_max_window_bits=r.clientMaxWindowBits:(n.client_max_window_bits===!0||r.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let r=e[0];if(this._options.clientNoContextTakeover===!1&&r.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!r.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(r.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&r.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return r}normalizeParams(e){return e.forEach(r=>{Object.keys(r).forEach(n=>{let i=r[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let s=+i;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=s}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let s=+i;if(!Number.isInteger(s)||s<8||s>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=s}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);r[n]=i})}),e}decompress(e,r,n){Er.add(i=>{this._decompress(e,r,(s,o)=>{i(),n(s,o)})})}compress(e,r,n){Er.add(i=>{this._compress(e,r,(s,o)=>{i(),n(s,o)})})}_decompress(e,r,n){let i=this._isServer?"client":"server";if(!this._inflate){let s=`${i}_max_window_bits`,o=typeof this.params[s]!="number"?jt.Z_DEFAULT_WINDOWBITS:this.params[s];this._inflate=jt.createInflateRaw({...this._options.zlibInflateOptions,windowBits:o}),this._inflate[kr]=this,this._inflate[Ne]=0,this._inflate[Ve]=[],this._inflate.on("error",Yp),this._inflate.on("data",ga)}this._inflate[Ut]=n,this._inflate.write(e),r&&this._inflate.write(Jp),this._inflate.flush(()=>{let s=this._inflate[Pr];if(s){this._inflate.close(),this._inflate=null,n(s);return}let o=da.concat(this._inflate[Ve],this._inflate[Ne]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[Ne]=0,this._inflate[Ve]=[],r&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),n(null,o)})}_compress(e,r,n){let i=this._isServer?"server":"client";if(!this._deflate){let s=`${i}_max_window_bits`,o=typeof this.params[s]!="number"?jt.Z_DEFAULT_WINDOWBITS:this.params[s];this._deflate=jt.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:o}),this._deflate[Ne]=0,this._deflate[Ve]=[],this._deflate.on("data",zp)}this._deflate[Ut]=n,this._deflate.write(e),this._deflate.flush(jt.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let s=da.concat(this._deflate[Ve],this._deflate[Ne]);r&&(s=new Gp(s.buffer,s.byteOffset,s.length-4)),this._deflate[Ut]=null,this._deflate[Ne]=0,this._deflate[Ve]=[],r&&this.params[`${i}_no_context_takeover`]&&this._deflate.reset(),n(null,s)})}};ya.exports=jn;function zp(t){this[Ve].push(t),this[Ne]+=t.length}function ga(t){if(this[Ne]+=t.length,this[kr]._maxPayload<1||this[Ne]<=this[kr]._maxPayload){this[Ve].push(t);return}this[Pr]=new RangeError("Max payload size exceeded"),this[Pr].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Pr][ha]=1009,this.removeListener("data",ga),this.reset()}function Yp(t){this[kr]._inflate=null,t[ha]=1007,this[Ut](t)}});var yt=x((I_,Cr)=>{"use strict";var{isUtf8:_a}=v("buffer"),{hasBlob:Kp}=Le(),Xp=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Zp(t){return t>=1e3&&t<=1014&&t!==1004&&t!==1005&&t!==1006||t>=3e3&&t<=4999}function Un(t){let e=t.length,r=0;for(;r<e;)if((t[r]&128)===0)r++;else if((t[r]&224)===192){if(r+1===e||(t[r+1]&192)!==128||(t[r]&254)===192)return!1;r+=2}else if((t[r]&240)===224){if(r+2>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||t[r]===224&&(t[r+1]&224)===128||t[r]===237&&(t[r+1]&224)===160)return!1;r+=3}else if((t[r]&248)===240){if(r+3>=e||(t[r+1]&192)!==128||(t[r+2]&192)!==128||(t[r+3]&192)!==128||t[r]===240&&(t[r+1]&240)===128||t[r]===244&&t[r+1]>143||t[r]>244)return!1;r+=4}else return!1;return!0}function Qp(t){return Kp&&typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&(t[Symbol.toStringTag]==="Blob"||t[Symbol.toStringTag]==="File")}Cr.exports={isBlob:Qp,isValidStatusCode:Zp,isValidUTF8:Un,tokenChars:Xp};if(_a)Cr.exports.isValidUTF8=function(t){return t.length<24?Un(t):_a(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=v("utf-8-validate");Cr.exports.isValidUTF8=function(e){return e.length<32?Un(e):t(e)}}catch{}});var Gn=x((M_,Pa)=>{"use strict";var{Writable:em}=v("stream"),wa=qt(),{BINARY_TYPES:tm,EMPTY_BUFFER:xa,kStatusCode:rm,kWebSocket:nm}=Le(),{concat:qn,toArrayBuffer:im,unmask:sm}=Bt(),{isValidStatusCode:om,isValidUTF8:va}=yt(),Or=Buffer[Symbol.species],ue=0,Sa=1,ba=2,Ea=3,Wn=4,Vn=5,Lr=6,Hn=class extends em{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||tm[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[nm]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=ue}_write(e,r,n){if(this._opcode===8&&this._state==ue)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=new Or(n.buffer,n.byteOffset+e,n.length-e),new Or(n.buffer,n.byteOffset,e)}let r=Buffer.allocUnsafe(e);do{let n=this._buffers[0],i=r.length-e;e>=n.length?r.set(this._buffers.shift(),i):(r.set(new Uint8Array(n.buffer,n.byteOffset,e),i),this._buffers[0]=new Or(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return r}startLoop(e){this._loop=!0;do switch(this._state){case ue:this.getInfo(e);break;case Sa:this.getPayloadLength16(e);break;case ba:this.getPayloadLength64(e);break;case Ea:this.getMask();break;case Wn:this.getData(e);break;case Vn:case Lr:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((r[0]&48)!==0){let i=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(i);return}let n=(r[0]&64)===64;if(n&&!this._extensions[wa.extensionName]){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(n){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(!this._fragmented){let i=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let i=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(i);return}if(n){let i=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(i);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let i=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(i);return}}else{let i=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(i);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked){let i=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(i);return}}else if(this._masked){let i=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(i);return}this._payloadLength===126?this._state=Sa:this._payloadLength===127?this._state=ba:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let r=this.consume(8),n=r.readUInt32BE(0);if(n>Math.pow(2,21)-1){let i=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(i);return}this._payloadLength=n*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let r=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(r);return}this._masked?this._state=Ea:this._state=Wn}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=Wn}getData(e){let r=xa;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}r=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0&&sm(r,this._mask)}if(this._opcode>7){this.controlMessage(r,e);return}if(this._compressed){this._state=Vn,this.decompress(r,e);return}r.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(r)),this.dataMessage(e)}decompress(e,r){this._extensions[wa.extensionName].decompress(e,this._fin,(i,s)=>{if(i)return r(i);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let o=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");r(o);return}this._fragments.push(s)}this.dataMessage(r),this._state===ue&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=ue;return}let r=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let i;this._binaryType==="nodebuffer"?i=qn(n,r):this._binaryType==="arraybuffer"?i=im(qn(n,r)):this._binaryType==="blob"?i=new Blob(n):i=n,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=ue):(this._state=Lr,setImmediate(()=>{this.emit("message",i,!0),this._state=ue,this.startLoop(e)}))}else{let i=qn(n,r);if(!this._skipUTF8Validation&&!va(i)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(s);return}this._state===Vn||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=ue):(this._state=Lr,setImmediate(()=>{this.emit("message",i,!1),this._state=ue,this.startLoop(e)}))}}controlMessage(e,r){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,xa),this.end();else{let n=e.readUInt16BE(0);if(!om(n)){let s=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");r(s);return}let i=new Or(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!va(i)){let s=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");r(s);return}this._loop=!1,this.emit("conclude",n,i),this.end()}this._state=ue;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=ue):(this._state=Lr,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=ue,this.startLoop(r)}))}createError(e,r,n,i,s){this._loop=!1,this._errored=!0;let o=new e(n?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(o,this.createError),o.code=s,o[rm]=i,o}};Pa.exports=Hn});var Yn=x((F_,Oa)=>{"use strict";var{Duplex:D_}=v("stream"),{randomFillSync:am}=v("crypto"),ka=qt(),{EMPTY_BUFFER:cm,kWebSocket:lm,NOOP:fm}=Le(),{isBlob:_t,isValidStatusCode:um}=yt(),{mask:Ca,toBuffer:tt}=Bt(),pe=Symbol("kByteLength"),pm=Buffer.alloc(4),Nr=8*1024,rt,wt=Nr,_e=0,mm=1,dm=2,Jn=class t{constructor(e,r,n){this._extensions=r||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=_e,this.onerror=fm,this[lm]=void 0}static frame(e,r){let n,i=!1,s=2,o=!1;r.mask&&(n=r.maskBuffer||pm,r.generateMask?r.generateMask(n):(wt===Nr&&(rt===void 0&&(rt=Buffer.alloc(Nr)),am(rt,0,Nr),wt=0),n[0]=rt[wt++],n[1]=rt[wt++],n[2]=rt[wt++],n[3]=rt[wt++]),o=(n[0]|n[1]|n[2]|n[3])===0,s=6);let a;typeof e=="string"?(!r.mask||o)&&r[pe]!==void 0?a=r[pe]:(e=Buffer.from(e),a=e.length):(a=e.length,i=r.mask&&r.readOnly&&!o);let l=a;a>=65536?(s+=8,l=127):a>125&&(s+=2,l=126);let f=Buffer.allocUnsafe(i?a+s:s);return f[0]=r.fin?r.opcode|128:r.opcode,r.rsv1&&(f[0]|=64),f[1]=l,l===126?f.writeUInt16BE(a,2):l===127&&(f[2]=f[3]=0,f.writeUIntBE(a,4,6)),r.mask?(f[1]|=128,f[s-4]=n[0],f[s-3]=n[1],f[s-2]=n[2],f[s-1]=n[3],o?[f,e]:i?(Ca(e,n,f,s,a),[f]):(Ca(e,n,e,0,a),[f,e])):[f,e]}close(e,r,n,i){let s;if(e===void 0)s=cm;else{if(typeof e!="number"||!um(e))throw new TypeError("First argument must be a valid error code number");if(r===void 0||!r.length)s=Buffer.allocUnsafe(2),s.writeUInt16BE(e,0);else{let a=Buffer.byteLength(r);if(a>123)throw new RangeError("The message must not be greater than 123 bytes");s=Buffer.allocUnsafe(2+a),s.writeUInt16BE(e,0),typeof r=="string"?s.write(r,2):s.set(r,2)}}let o={[pe]:s.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._state!==_e?this.enqueue([this.dispatch,s,!1,o,i]):this.sendFrame(t.frame(s,o),i)}ping(e,r,n){let i,s;if(typeof e=="string"?(i=Buffer.byteLength(e),s=!1):_t(e)?(i=e.size,s=!1):(e=tt(e),i=e.length,s=tt.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[pe]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};_t(e)?this._state!==_e?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):this._state!==_e?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(t.frame(e,o),n)}pong(e,r,n){let i,s;if(typeof e=="string"?(i=Buffer.byteLength(e),s=!1):_t(e)?(i=e.size,s=!1):(e=tt(e),i=e.length,s=tt.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");let o={[pe]:i,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};_t(e)?this._state!==_e?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):this._state!==_e?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(t.frame(e,o),n)}send(e,r,n){let i=this._extensions[ka.extensionName],s=r.binary?2:1,o=r.compress,a,l;typeof e=="string"?(a=Buffer.byteLength(e),l=!1):_t(e)?(a=e.size,l=!1):(e=tt(e),a=e.length,l=tt.readOnly),this._firstFragment?(this._firstFragment=!1,o&&i&&i.params[i._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=a>=i._threshold),this._compress=o):(o=!1,s=0),r.fin&&(this._firstFragment=!0);let f={[pe]:a,fin:r.fin,generateMask:this._generateMask,mask:r.mask,maskBuffer:this._maskBuffer,opcode:s,readOnly:l,rsv1:o};_t(e)?this._state!==_e?this.enqueue([this.getBlobData,e,this._compress,f,n]):this.getBlobData(e,this._compress,f,n):this._state!==_e?this.enqueue([this.dispatch,e,this._compress,f,n]):this.dispatch(e,this._compress,f,n)}getBlobData(e,r,n,i){this._bufferedBytes+=n[pe],this._state=dm,e.arrayBuffer().then(s=>{if(this._socket.destroyed){let a=new Error("The socket was closed while the blob was being read");process.nextTick(zn,this,a,i);return}this._bufferedBytes-=n[pe];let o=tt(s);r?this.dispatch(o,r,n,i):(this._state=_e,this.sendFrame(t.frame(o,n),i),this.dequeue())}).catch(s=>{process.nextTick(hm,this,s,i)})}dispatch(e,r,n,i){if(!r){this.sendFrame(t.frame(e,n),i);return}let s=this._extensions[ka.extensionName];this._bufferedBytes+=n[pe],this._state=mm,s.compress(e,n.fin,(o,a)=>{if(this._socket.destroyed){let l=new Error("The socket was closed while data was being compressed");zn(this,l,i);return}this._bufferedBytes-=n[pe],this._state=_e,n.readOnly=!1,this.sendFrame(t.frame(a,n),i),this.dequeue()})}dequeue(){for(;this._state===_e&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][pe],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][pe],this._queue.push(e)}sendFrame(e,r){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],r),this._socket.uncork()):this._socket.write(e[0],r)}};Oa.exports=Jn;function zn(t,e,r){typeof r=="function"&&r(e);for(let n=0;n<t._queue.length;n++){let i=t._queue[n],s=i[i.length-1];typeof s=="function"&&s(e)}}function hm(t,e,r){zn(t,e,r),t.onerror(e)}});var $a=x((A_,Aa)=>{"use strict";var{kForOnEventAttribute:Wt,kListener:Kn}=Le(),La=Symbol("kCode"),Na=Symbol("kData"),Ta=Symbol("kError"),Ia=Symbol("kMessage"),Ma=Symbol("kReason"),xt=Symbol("kTarget"),Da=Symbol("kType"),Fa=Symbol("kWasClean"),Te=class{constructor(e){this[xt]=null,this[Da]=e}get target(){return this[xt]}get type(){return this[Da]}};Object.defineProperty(Te.prototype,"target",{enumerable:!0});Object.defineProperty(Te.prototype,"type",{enumerable:!0});var nt=class extends Te{constructor(e,r={}){super(e),this[La]=r.code===void 0?0:r.code,this[Ma]=r.reason===void 0?"":r.reason,this[Fa]=r.wasClean===void 0?!1:r.wasClean}get code(){return this[La]}get reason(){return this[Ma]}get wasClean(){return this[Fa]}};Object.defineProperty(nt.prototype,"code",{enumerable:!0});Object.defineProperty(nt.prototype,"reason",{enumerable:!0});Object.defineProperty(nt.prototype,"wasClean",{enumerable:!0});var vt=class extends Te{constructor(e,r={}){super(e),this[Ta]=r.error===void 0?null:r.error,this[Ia]=r.message===void 0?"":r.message}get error(){return this[Ta]}get message(){return this[Ia]}};Object.defineProperty(vt.prototype,"error",{enumerable:!0});Object.defineProperty(vt.prototype,"message",{enumerable:!0});var Vt=class extends Te{constructor(e,r={}){super(e),this[Na]=r.data===void 0?null:r.data}get data(){return this[Na]}};Object.defineProperty(Vt.prototype,"data",{enumerable:!0});var gm={addEventListener(t,e,r={}){for(let i of this.listeners(t))if(!r[Wt]&&i[Kn]===e&&!i[Wt])return;let n;if(t==="message")n=function(s,o){let a=new Vt("message",{data:o?s:s.toString()});a[xt]=this,Tr(e,this,a)};else if(t==="close")n=function(s,o){let a=new nt("close",{code:s,reason:o.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});a[xt]=this,Tr(e,this,a)};else if(t==="error")n=function(s){let o=new vt("error",{error:s,message:s.message});o[xt]=this,Tr(e,this,o)};else if(t==="open")n=function(){let s=new Te("open");s[xt]=this,Tr(e,this,s)};else return;n[Wt]=!!r[Wt],n[Kn]=e,r.once?this.once(t,n):this.on(t,n)},removeEventListener(t,e){for(let r of this.listeners(t))if(r[Kn]===e&&!r[Wt]){this.removeListener(t,r);break}}};Aa.exports={CloseEvent:nt,ErrorEvent:vt,Event:Te,EventTarget:gm,MessageEvent:Vt};function Tr(t,e,r){typeof t=="object"&&t.handleEvent?t.handleEvent.call(t,r):t.call(e,r)}});var Xn=x(($_,Ra)=>{"use strict";var{tokenChars:Ht}=yt();function be(t,e,r){t[e]===void 0?t[e]=[r]:t[e].push(r)}function ym(t){let e=Object.create(null),r=Object.create(null),n=!1,i=!1,s=!1,o,a,l=-1,f=-1,c=-1,u=0;for(;u<t.length;u++)if(f=t.charCodeAt(u),o===void 0)if(c===-1&&Ht[f]===1)l===-1&&(l=u);else if(u!==0&&(f===32||f===9))c===-1&&l!==-1&&(c=u);else if(f===59||f===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);let m=t.slice(l,c);f===44?(be(e,m,r),r=Object.create(null)):o=m,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(c===-1&&Ht[f]===1)l===-1&&(l=u);else if(f===32||f===9)c===-1&&l!==-1&&(c=u);else if(f===59||f===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u),be(r,t.slice(l,c),!0),f===44&&(be(e,o,r),r=Object.create(null),o=void 0),l=c=-1}else if(f===61&&l!==-1&&c===-1)a=t.slice(l,u),l=c=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(Ht[f]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1?l=u:n||(n=!0),i=!1}else if(s)if(Ht[f]===1)l===-1&&(l=u);else if(f===34&&l!==-1)s=!1,c=u;else if(f===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(f===34&&t.charCodeAt(u-1)===61)s=!0;else if(c===-1&&Ht[f]===1)l===-1&&(l=u);else if(l!==-1&&(f===32||f===9))c===-1&&(c=u);else if(f===59||f===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);let m=t.slice(l,c);n&&(m=m.replace(/\\/g,""),n=!1),be(r,a,m),f===44&&(be(e,o,r),r=Object.create(null),o=void 0),a=void 0,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);if(l===-1||s||f===32||f===9)throw new SyntaxError("Unexpected end of input");c===-1&&(c=u);let p=t.slice(l,c);return o===void 0?be(e,p,r):(a===void 0?be(r,p,!0):n?be(r,a,p.replace(/\\/g,"")):be(r,a,p),be(e,o,r)),e}function _m(t){return Object.keys(t).map(e=>{let r=t[e];return Array.isArray(r)||(r=[r]),r.map(n=>[e].concat(Object.keys(n).map(i=>{let s=n[i];return Array.isArray(s)||(s=[s]),s.map(o=>o===!0?i:`${i}=${o}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Ra.exports={format:_m,parse:ym}});var Fr=x((j_,Ka)=>{"use strict";var wm=v("events"),xm=v("https"),vm=v("http"),Ua=v("net"),Sm=v("tls"),{randomBytes:bm,createHash:Em}=v("crypto"),{Duplex:R_,Readable:B_}=v("stream"),{URL:Zn}=v("url"),He=qt(),Pm=Gn(),km=Yn(),{isBlob:Cm}=yt(),{BINARY_TYPES:Ba,EMPTY_BUFFER:Ir,GUID:Om,kForOnEventAttribute:Qn,kListener:Lm,kStatusCode:Nm,kWebSocket:V,NOOP:qa}=Le(),{EventTarget:{addEventListener:Tm,removeEventListener:Im}}=$a(),{format:Mm,parse:Dm}=Xn(),{toBuffer:Fm}=Bt(),Am=30*1e3,Wa=Symbol("kAborted"),ei=[8,13],Ie=["CONNECTING","OPEN","CLOSING","CLOSED"],$m=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,D=class t extends wm{constructor(e,r,n){super(),this._binaryType=Ba[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=Ir,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=t.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,r===void 0?r=[]:Array.isArray(r)||(typeof r=="object"&&r!==null?(n=r,r=[]):r=[r]),Va(this,e,r,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Ba.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,r,n){let i=new Pm({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),s=new km(e,this._extensions,n.generateMask);this._receiver=i,this._sender=s,this._socket=e,i[V]=this,s[V]=this,e[V]=this,i.on("conclude",jm),i.on("drain",Um),i.on("error",qm),i.on("message",Wm),i.on("ping",Vm),i.on("pong",Hm),s.onerror=Gm,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),r.length>0&&e.unshift(r),e.on("close",Ja),e.on("data",Dr),e.on("end",za),e.on("error",Ya),this._readyState=t.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[He.extensionName]&&this._extensions[He.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=t.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,r){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){oe(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===t.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=t.CLOSING,this._sender.close(e,r,!this._isServer,n=>{n||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Ga(this)}}pause(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){ti(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.ping(e||Ir,r,n)}pong(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(n=e,e=r=void 0):typeof r=="function"&&(n=r,r=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){ti(this,e,n);return}r===void 0&&(r=!this._isServer),this._sender.pong(e||Ir,r,n)}resume(){this.readyState===t.CONNECTING||this.readyState===t.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,r,n){if(this.readyState===t.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"&&(n=r,r={}),typeof e=="number"&&(e=e.toString()),this.readyState!==t.OPEN){ti(this,e,n);return}let i={binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0,...r};this._extensions[He.extensionName]||(i.compress=!1),this._sender.send(e||Ir,i,n)}terminate(){if(this.readyState!==t.CLOSED){if(this.readyState===t.CONNECTING){oe(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=t.CLOSING,this._socket.destroy())}}};Object.defineProperty(D,"CONNECTING",{enumerable:!0,value:Ie.indexOf("CONNECTING")});Object.defineProperty(D.prototype,"CONNECTING",{enumerable:!0,value:Ie.indexOf("CONNECTING")});Object.defineProperty(D,"OPEN",{enumerable:!0,value:Ie.indexOf("OPEN")});Object.defineProperty(D.prototype,"OPEN",{enumerable:!0,value:Ie.indexOf("OPEN")});Object.defineProperty(D,"CLOSING",{enumerable:!0,value:Ie.indexOf("CLOSING")});Object.defineProperty(D.prototype,"CLOSING",{enumerable:!0,value:Ie.indexOf("CLOSING")});Object.defineProperty(D,"CLOSED",{enumerable:!0,value:Ie.indexOf("CLOSED")});Object.defineProperty(D.prototype,"CLOSED",{enumerable:!0,value:Ie.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(t=>{Object.defineProperty(D.prototype,t,{enumerable:!0})});["open","error","close","message"].forEach(t=>{Object.defineProperty(D.prototype,`on${t}`,{enumerable:!0,get(){for(let e of this.listeners(t))if(e[Qn])return e[Lm];return null},set(e){for(let r of this.listeners(t))if(r[Qn]){this.removeListener(t,r);break}typeof e=="function"&&this.addEventListener(t,e,{[Qn]:!0})}})});D.prototype.addEventListener=Tm;D.prototype.removeEventListener=Im;Ka.exports=D;function Va(t,e,r,n){let i={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:ei[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=i.autoPong,!ei.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${ei.join(", ")})`);let s;if(e instanceof Zn)s=e;else try{s=new Zn(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}s.protocol==="http:"?s.protocol="ws:":s.protocol==="https:"&&(s.protocol="wss:"),t._url=s.href;let o=s.protocol==="wss:",a=s.protocol==="ws+unix:",l;if(s.protocol!=="ws:"&&!o&&!a?l=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:a&&!s.pathname?l="The URL's pathname is empty":s.hash&&(l="The URL contains a fragment identifier"),l){let g=new SyntaxError(l);if(t._redirects===0)throw g;Mr(t,g);return}let f=o?443:80,c=bm(16).toString("base64"),u=o?xm.request:vm.request,p=new Set,m;if(i.createConnection=i.createConnection||(o?Bm:Rm),i.defaultPort=i.defaultPort||f,i.port=s.port||f,i.host=s.hostname.startsWith("[")?s.hostname.slice(1,-1):s.hostname,i.headers={...i.headers,"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},i.path=s.pathname+s.search,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(m=new He(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=Mm({[He.extensionName]:m.offer()})),r.length){for(let g of r){if(typeof g!="string"||!$m.test(g)||p.has(g))throw new SyntaxError("An invalid or duplicated subprotocol was specified");p.add(g)}i.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),(s.username||s.password)&&(i.auth=`${s.username}:${s.password}`),a){let g=i.path.split(":");i.socketPath=g[0],i.path=g[1]}let h;if(i.followRedirects){if(t._redirects===0){t._originalIpc=a,t._originalSecure=o,t._originalHostOrSocketPath=a?i.socketPath:s.host;let g=n&&n.headers;if(n={...n,headers:{}},g)for(let[_,S]of Object.entries(g))n.headers[_.toLowerCase()]=S}else if(t.listenerCount("redirect")===0){let g=a?t._originalIpc?i.socketPath===t._originalHostOrSocketPath:!1:t._originalIpc?!1:s.host===t._originalHostOrSocketPath;(!g||t._originalSecure&&!o)&&(delete i.headers.authorization,delete i.headers.cookie,g||delete i.headers.host,i.auth=void 0)}i.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(i.auth).toString("base64")),h=t._req=u(i),t._redirects&&t.emit("redirect",t.url,h)}else h=t._req=u(i);i.timeout&&h.on("timeout",()=>{oe(t,h,"Opening handshake has timed out")}),h.on("error",g=>{h===null||h[Wa]||(h=t._req=null,Mr(t,g))}),h.on("response",g=>{let _=g.headers.location,S=g.statusCode;if(_&&i.followRedirects&&S>=300&&S<400){if(++t._redirects>i.maxRedirects){oe(t,h,"Maximum redirects exceeded");return}h.abort();let C;try{C=new Zn(_,e)}catch{let Y=new SyntaxError(`Invalid URL: ${_}`);Mr(t,Y);return}Va(t,C,r,n)}else t.emit("unexpected-response",h,g)||oe(t,h,`Unexpected server response: ${g.statusCode}`)}),h.on("upgrade",(g,_,S)=>{if(t.emit("upgrade",g),t.readyState!==D.CONNECTING)return;h=t._req=null;let C=g.headers.upgrade;if(C===void 0||C.toLowerCase()!=="websocket"){oe(t,_,"Invalid Upgrade header");return}let T=Em("sha1").update(c+Om).digest("base64");if(g.headers["sec-websocket-accept"]!==T){oe(t,_,"Invalid Sec-WebSocket-Accept header");return}let Y=g.headers["sec-websocket-protocol"],de;if(Y!==void 0?p.size?p.has(Y)||(de="Server sent an invalid subprotocol"):de="Server sent a subprotocol but none was requested":p.size&&(de="Server sent no subprotocol"),de){oe(t,_,de);return}Y&&(t._protocol=Y);let Fe=g.headers["sec-websocket-extensions"];if(Fe!==void 0){if(!m){oe(t,_,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let Ae;try{Ae=Dm(Fe)}catch{oe(t,_,"Invalid Sec-WebSocket-Extensions header");return}let ke=Object.keys(Ae);if(ke.length!==1||ke[0]!==He.extensionName){oe(t,_,"Server indicated an extension that was not requested");return}try{m.accept(Ae[He.extensionName])}catch{oe(t,_,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[He.extensionName]=m}t.setSocket(_,S,{allowSynchronousEvents:i.allowSynchronousEvents,generateMask:i.generateMask,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation})}),i.finishRequest?i.finishRequest(h,t):h.end()}function Mr(t,e){t._readyState=D.CLOSING,t._errorEmitted=!0,t.emit("error",e),t.emitClose()}function Rm(t){return t.path=t.socketPath,Ua.connect(t)}function Bm(t){return t.path=void 0,!t.servername&&t.servername!==""&&(t.servername=Ua.isIP(t.host)?"":t.host),Sm.connect(t)}function oe(t,e,r){t._readyState=D.CLOSING;let n=new Error(r);Error.captureStackTrace(n,oe),e.setHeader?(e[Wa]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Mr,t,n)):(e.destroy(n),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function ti(t,e,r){if(e){let n=Cm(e)?e.size:Fm(e).length;t._socket?t._sender._bufferedBytes+=n:t._bufferedAmount+=n}if(r){let n=new Error(`WebSocket is not open: readyState ${t.readyState} (${Ie[t.readyState]})`);process.nextTick(r,n)}}function jm(t,e){let r=this[V];r._closeFrameReceived=!0,r._closeMessage=e,r._closeCode=t,r._socket[V]!==void 0&&(r._socket.removeListener("data",Dr),process.nextTick(Ha,r._socket),t===1005?r.close():r.close(t,e))}function Um(){let t=this[V];t.isPaused||t._socket.resume()}function qm(t){let e=this[V];e._socket[V]!==void 0&&(e._socket.removeListener("data",Dr),process.nextTick(Ha,e._socket),e.close(t[Nm])),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t))}function ja(){this[V].emitClose()}function Wm(t,e){this[V].emit("message",t,e)}function Vm(t){let e=this[V];e._autoPong&&e.pong(t,!this._isServer,qa),e.emit("ping",t)}function Hm(t){this[V].emit("pong",t)}function Ha(t){t.resume()}function Gm(t){let e=this[V];e.readyState!==D.CLOSED&&(e.readyState===D.OPEN&&(e._readyState=D.CLOSING,Ga(e)),this._socket.end(),e._errorEmitted||(e._errorEmitted=!0,e.emit("error",t)))}function Ga(t){t._closeTimer=setTimeout(t._socket.destroy.bind(t._socket),Am)}function Ja(){let t=this[V];this.removeListener("close",Ja),this.removeListener("data",Dr),this.removeListener("end",za),t._readyState=D.CLOSING;let e;!this._readableState.endEmitted&&!t._closeFrameReceived&&!t._receiver._writableState.errorEmitted&&(e=t._socket.read())!==null&&t._receiver.write(e),t._receiver.end(),this[V]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",ja),t._receiver.on("finish",ja))}function Dr(t){this[V]._receiver.write(t)||this.pause()}function za(){let t=this[V];t._readyState=D.CLOSING,t._receiver.end(),this.end()}function Ya(){let t=this[V];this.removeListener("error",Ya),this.on("error",qa),t&&(t._readyState=D.CLOSING,this.destroy())}});var ec=x((q_,Qa)=>{"use strict";var U_=Fr(),{Duplex:Jm}=v("stream");function Xa(t){t.emit("close")}function zm(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Za(t){this.removeListener("error",Za),this.destroy(),this.listenerCount("error")===0&&this.emit("error",t)}function Ym(t,e){let r=!0,n=new Jm({...e,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return t.on("message",function(s,o){let a=!o&&n._readableState.objectMode?s.toString():s;n.push(a)||t.pause()}),t.once("error",function(s){n.destroyed||(r=!1,n.destroy(s))}),t.once("close",function(){n.destroyed||n.push(null)}),n._destroy=function(i,s){if(t.readyState===t.CLOSED){s(i),process.nextTick(Xa,n);return}let o=!1;t.once("error",function(l){o=!0,s(l)}),t.once("close",function(){o||s(i),process.nextTick(Xa,n)}),r&&t.terminate()},n._final=function(i){if(t.readyState===t.CONNECTING){t.once("open",function(){n._final(i)});return}t._socket!==null&&(t._socket._writableState.finished?(i(),n._readableState.endEmitted&&n.destroy()):(t._socket.once("finish",function(){i()}),t.close()))},n._read=function(){t.isPaused&&t.resume()},n._write=function(i,s,o){if(t.readyState===t.CONNECTING){t.once("open",function(){n._write(i,s,o)});return}t.send(i,o)},n.on("end",zm),n.on("error",Za),n}Qa.exports=Ym});var rc=x((W_,tc)=>{"use strict";var{tokenChars:Km}=yt();function Xm(t){let e=new Set,r=-1,n=-1,i=0;for(i;i<t.length;i++){let o=t.charCodeAt(i);if(n===-1&&Km[o]===1)r===-1&&(r=i);else if(i!==0&&(o===32||o===9))n===-1&&r!==-1&&(n=i);else if(o===44){if(r===-1)throw new SyntaxError(`Unexpected character at index ${i}`);n===-1&&(n=i);let a=t.slice(r,n);if(e.has(a))throw new SyntaxError(`The "${a}" subprotocol is duplicated`);e.add(a),r=n=-1}else throw new SyntaxError(`Unexpected character at index ${i}`)}if(r===-1||n!==-1)throw new SyntaxError("Unexpected end of input");let s=t.slice(r,i);if(e.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);return e.add(s),e}tc.exports={parse:Xm}});var lc=x((H_,cc)=>{"use strict";var Zm=v("events"),Ar=v("http"),{Duplex:V_}=v("stream"),{createHash:Qm}=v("crypto"),nc=Xn(),it=qt(),ed=rc(),td=Fr(),{GUID:rd,kWebSocket:nd}=Le(),id=/^[+/0-9A-Za-z]{22}==$/,ic=0,sc=1,ac=2,ri=class extends Zm{constructor(e,r){if(super(),e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:td,...e},e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=Ar.createServer((n,i)=>{let s=Ar.STATUS_CODES[426];i.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),i.end(s)}),this._server.listen(e.port,e.host,e.backlog,r)):e.server&&(this._server=e.server),this._server){let n=this.emit.bind(this,"connection");this._removeListeners=sd(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(i,s,o)=>{this.handleUpgrade(i,s,o,n)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=ic}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===ac){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Gt,this);return}if(e&&this.once("close",e),this._state!==sc)if(this._state=sc,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Gt,this):process.nextTick(Gt,this);else{let r=this._server;this._removeListeners(),this._removeListeners=this._server=null,r.close(()=>{Gt(this)})}}shouldHandle(e){if(this.options.path){let r=e.url.indexOf("?");if((r!==-1?e.url.slice(0,r):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,r,n,i){r.on("error",oc);let s=e.headers["sec-websocket-key"],o=e.headers.upgrade,a=+e.headers["sec-websocket-version"];if(e.method!=="GET"){st(this,e,r,405,"Invalid HTTP method");return}if(o===void 0||o.toLowerCase()!=="websocket"){st(this,e,r,400,"Invalid Upgrade header");return}if(s===void 0||!id.test(s)){st(this,e,r,400,"Missing or invalid Sec-WebSocket-Key header");return}if(a!==8&&a!==13){st(this,e,r,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){Jt(r,400);return}let l=e.headers["sec-websocket-protocol"],f=new Set;if(l!==void 0)try{f=ed.parse(l)}catch{st(this,e,r,400,"Invalid Sec-WebSocket-Protocol header");return}let c=e.headers["sec-websocket-extensions"],u={};if(this.options.perMessageDeflate&&c!==void 0){let p=new it(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let m=nc.parse(c);m[it.extensionName]&&(p.accept(m[it.extensionName]),u[it.extensionName]=p)}catch{st(this,e,r,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let p={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(p,(m,h,g,_)=>{if(!m)return Jt(r,h||401,g,_);this.completeUpgrade(u,s,f,e,r,n,i)});return}if(!this.options.verifyClient(p))return Jt(r,401)}this.completeUpgrade(u,s,f,e,r,n,i)}completeUpgrade(e,r,n,i,s,o,a){if(!s.readable||!s.writable)return s.destroy();if(s[nd])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>ic)return Jt(s,503);let f=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Qm("sha1").update(r+rd).digest("base64")}`],c=new this.options.WebSocket(null,void 0,this.options);if(n.size){let u=this.options.handleProtocols?this.options.handleProtocols(n,i):n.values().next().value;u&&(f.push(`Sec-WebSocket-Protocol: ${u}`),c._protocol=u)}if(e[it.extensionName]){let u=e[it.extensionName].params,p=nc.format({[it.extensionName]:[u]});f.push(`Sec-WebSocket-Extensions: ${p}`),c._extensions=e}this.emit("headers",f,i),s.write(f.concat(`\r
`).join(`\r
`)),s.removeListener("error",oc),c.setSocket(s,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(c),c.on("close",()=>{this.clients.delete(c),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Gt,this)})),a(c,i)}};cc.exports=ri;function sd(t,e){for(let r of Object.keys(e))t.on(r,e[r]);return function(){for(let n of Object.keys(e))t.removeListener(n,e[n])}}function Gt(t){t._state=ac,t.emit("close")}function oc(){this.destroy()}function Jt(t,e,r,n){r=r||Ar.STATUS_CODES[e],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(r),...n},t.once("finish",t.destroy),t.end(`HTTP/1.1 ${e} ${Ar.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+r)}function st(t,e,r,n,i){if(t.listenerCount("wsClientError")){let s=new Error(i);Error.captureStackTrace(s,st),t.emit("wsClientError",s,r,e)}else Jt(r,n,i)}});var od,ad,cd,ni,ii,fc=y(()=>{od=$(ec(),1),ad=$(Gn(),1),cd=$(Yn(),1),ni=$(Fr(),1),ii=$(lc(),1)});var uc=y(()=>{});var ld,$r,si,mc,oi=y(()=>{fc();uc();ld=(t,e)=>{let r=new ii.default({host:t,port:e+1});return{broadcast:i=>{for(let s of r.clients)s.readyState===ni.default.OPEN&&s.send(JSON.stringify({type:i}))}}},si=(t="localhost",e)=>{if(process.env.NODE_ENV==="production")return null;if($r)return $r;if(!e)throw new Error("HMR port is not provided");return $r=ld(t,e),$r},mc=t=>{if(process.env.NODE_ENV==="production")return;let e=si();e&&e.broadcast(t)}});var St,Rr=y(()=>{at();St=()=>{let t=Be(),{target:e,tag:r}=t,[n,i]=e.split("-");return{tag:r,target:e,browser:n,manifestVersion:i}}});import{AssertionError as fd}from"assert";function bt(t){throw new Error("Statement should be unreachable")}function ai(t,e="Value is invalid"){if(!t)throw new fd({message:e});return t}var zt=y(()=>{});function gd(t){switch(t){case 0:return"Web";case 1:case 2:case 3:return yc[t];default:bt(t)}}var li,jr,fi,Yt,ud,pd,dc,md,dd,hd,ci,ui,Je,ze,ae,hc,gc,rw,yc,Br,nw,iw,_c,wc,sw,Ee,Ge,yd,ow,_d,aw,cw,lw,fw,xc=y(()=>{zt();li="en",jr=!1,fi=!1,Yt=!1,ud=!1,pd=!1,dc=!1,md=!1,dd=!1,hd=!1,ui=li,ze=typeof self=="object"?self:typeof global=="object"?global:{};typeof ze.vscode<"u"&&typeof ze.vscode.process<"u"?ae=ze.vscode.process:typeof process<"u"&&(ae=process);hc=typeof ae?.versions?.electron=="string",gc=hc&&ae?.type==="renderer",rw=gc&&ae?.sandboxed;typeof navigator=="object"&&!gc?(Je=navigator.userAgent,jr=Je.indexOf("Windows")>=0,fi=Je.indexOf("Macintosh")>=0,dd=(Je.indexOf("Macintosh")>=0||Je.indexOf("iPad")>=0||Je.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Yt=Je.indexOf("Linux")>=0,dc=!0,ci=navigator.language,ui=ci):typeof ae=="object"?(jr=ae.platform==="win32",fi=ae.platform==="darwin",Yt=ae.platform==="linux",ud=Yt&&!!ae.env.SNAP&&!!ae.env.SNAP_REVISION,md=hc,hd=!!ae.env.CI||!!ae.env.BUILD_ARTIFACTSTAGINGDIRECTORY,ci=li,ui=li,pd=!0):console.error("Unable to resolve platform.");yc={1:"Mac",2:"Linux",3:"Windows"};Br=0;fi?Br=1:jr?Br=3:Yt&&(Br=2);nw=Object.values(yc),iw=gd(Br),_c=jr,wc=Yt,sw=dc&&typeof ze.importScripts=="function",Ee=Je,Ge=ui;(n=>{function t(){return Ge}n.value=t;function e(){return Ge.length===2?Ge==="en":Ge.length>=3?Ge[0]==="e"&&Ge[1]==="n"&&Ge[2]==="-":!1}n.isDefaultVariant=e;function r(){return Ge==="en"}n.isDefault=r})(yd||={});ow=(()=>{if(typeof ze.postMessage=="function"&&!ze.importScripts){let t=[];ze.addEventListener("message",r=>{if(r.data&&r.data.vscodeScheduleAsyncWork)for(let n=0,i=t.length;n<i;n++){let s=t[n];if(s.id===r.data.vscodeScheduleAsyncWork){t.splice(n,1),s.callback();return}}});let e=0;return r=>{let n=++e;t.push({id:n,callback:r}),ze.postMessage({vscodeScheduleAsyncWork:n},"*")}}return t=>setTimeout(t)})(),_d=!!(Ee&&Ee.indexOf("Chrome")>=0),aw=!!(Ee&&Ee.indexOf("Firefox")>=0),cw=!!(!_d&&Ee&&Ee.indexOf("Safari")>=0),lw=!!(Ee&&Ee.indexOf("Edg/")>=0),fw=!!(Ee&&Ee.indexOf("Android")>=0)});var vc,Sc=y(()=>{xc();vc=_c?"windows":wc?"inotify":"fs-events"});async function Me(t,e){for(let r of t)if(await e(r))return r}var Kt=y(()=>{});import{basename as wd,extname as bc,posix as xd,win32 as vd}from"path";var ce,Ec,Et=y(()=>{ce=t=>t.replaceAll(vd.sep,xd.sep),Ec=t=>bc(wd(t,bc(t)))});import{readFile as Sd}from"fs/promises";import{resolve as bd}from"path";import{constantCase as Pc}from"change-case";import Ed from"dotenv";import{expand as Pd}from"dotenv-expand";function Cd(t){let e=Object.assign({},process.env);for(let{contents:r,name:n}of t)try{kc.add(n);let i=Pd({ignoreProcessEnv:!0,parsed:Ed.parse(r)});if(i.parsed){d(`Loaded env from ${n}`);let s=i.parsed||{};for(let[o,a]of Object.entries(s))if(typeof e[o]>"u"){try{e[o]=Ld(a)}catch(l){le(`Failed to parse JSON directive ${o} in ${n}:`,l.message)}o.startsWith(mi)&&(process.env[o]=a)}}}catch(i){le(`Failed to load env from ${n}`,i)}return e}function Ld(t){let e=t.match(Od);return e?JSON.parse(e[1]):t}async function Oc(t){let e=await Promise.all(di().map(s=>[s,bd(t,s)]).map(async([s,o])=>[s,o,await ar(o)&&await or(o)])),r=await Promise.all(e.filter(([,,s])=>s).map(async([s,o])=>({name:s,contents:await Sd(o,"utf8")}))),n=Cd(r),i=new pi(n);return{combinedEnv:n,plasmoPublicEnv:i,loadedEnvFiles:r}}var mi,kd,kc,pi,Od,Cc,di,Ur=y(()=>{X();k();at();mi="PLASMO_",kd="PLASMO_PUBLIC_",kc=new Set,pi=class t{data;constructor(e){this.data=Object.keys(e).filter(r=>r.startsWith(kd)).reduce((r,n)=>(r[n]=e[n],r),{})}extends(e){N("Loaded environment variables from:",[...kc]);let r=new t({...this.data});return r.data.NODE_ENV=process.env.NODE_ENV,Object.entries(e).forEach(([n,i])=>{r.data[`${mi}${Pc(n)}`]=i}),r}};Od=/^\s*json\((.+)\)\s*$/si;Cc=t=>{for(let[e,r]of Object.entries(t))process.env[`${mi}${Pc(e)}`]=r},di=()=>{let t=process.env.NODE_ENV,e=Be();return[e.envPath,`.env.${e.browser}.local`,`.env.${e.tag}.local`,`.env.${t}.local`,t!=="test"?".env.local":"",`.env.${e.browser}`,`.env.${e.tag}`,`.env.${t}`,".env"].filter(r=>!!r)}});import{resolve as Nd}from"path";async function Nc({commonPath:t,publicEnv:e}){let r=Object.keys(e.data);r.length!==0&&await(0,Lc.outputFile)(Nd(t.dotPlasmoDirectory,Td),Id(r))}var Lc,hi,Td,Id,gi=y(()=>{Lc=$(z(),1),hi="process.env",Td=`${hi}.d.ts`,Id=t=>`
declare namespace NodeJS {
  interface ProcessEnv {
${t.map(e=>`		${e}?: string`).join(`
`)}
  }
}
`});import Md from"typescript";var we,Xt,Tc=y(()=>{({SyntaxKind:we}=Md),Xt=t=>{switch(t.kind){case we.StringLiteral:return t.text;case we.TrueKeyword:return!0;case we.FalseKeyword:return!1;case we.NullKeyword:return null;case we.NumericLiteral:return parseFloat(t.text);case we.ArrayLiteralExpression:return t.elements.filter(e=>e.kind!==we.SpreadElement).map(Xt);case we.ObjectLiteralExpression:return t.properties.filter(e=>e.kind===we.PropertyAssignment&&(e.name.kind===we.Identifier||e.name.kind===we.StringLiteral)).map(e=>[e.name.escapedText||e.name.text,Xt(e.initializer)]).reduce((e,[r,n])=>({...e,[r]:n}),{});default:return}}});import{readFile as Dd}from"fs/promises";import Fd from"typescript";var Ad,$d,Rd,Bd,jd,Ic,Mc=y(()=>{k();Tc();({ScriptTarget:Ad,SyntaxKind:$d,createSourceFile:Rd,isObjectLiteralExpression:Bd,isVariableStatement:jd}=Fd),Ic=async t=>{try{let e=await Dd(t,"utf8");if(e.length===0)return{isEmpty:!0};let n=Rd(t,e,Ad.Latest,!0).statements.filter(jd).reduce((o,a)=>(a.declarationList.forEachChild(l=>{o[l.name.getText()]=l.initializer}),o),{}),i=n.config;if(!i||!Bd(i))return null;let s=i.properties.reduce((o,a)=>{if(a.getChildCount()<3)return o;let[l,f,c]=a.getChildren(),u=l.getText();try{c.kind===$d.Identifier?o[u]=Xt(n[c.getText()]):o[u]=Xt(c)}catch(p){le(p)}return o},{});return d("Parsed config:",s),{config:s}}catch(e){return d(e),null}}});import{basename as Dc,resolve as yi}from"path";import qr from"sharp";async function Wr({assetsDirectory:t,genAssetsDirectory:e}){if(Pt.baseIconPaths.length===0){let s=Fc();Pt.baseIconPaths=s.map(o=>yi(t,o))}let r=await Me(Pt.baseIconPaths,A);if(r===void 0){j("No icon found in assets directory");return}await(0,Zt.ensureDir)(e);let i=await qr(r).toBuffer();d(`${r} found, creating resized icons`),await Promise.all(qd.map(async s=>{if(Pt.devProvidedIcons[s]===void 0){let l=Fc(_i(s));Pt.devProvidedIcons[s]=l.map(f=>yi(t,f))}let o=await Me(Pt.devProvidedIcons[s],A),a=yi(e,`icon${s}.plasmo.png`);return process.env.NODE_ENV==="development"?o!==void 0?Dc(o).includes(".development.")?(0,Zt.copy)(o,a):qr(o).grayscale().toFile(a):qr(Buffer.from(i)).resize({width:s,height:s}).greyscale(!Dc(r).includes(".development.")).toFile(a):o!==void 0?(0,Zt.copy)(o,a):qr(Buffer.from(i)).resize({width:s,height:s}).toFile(a)}))}var Zt,_i,Ud,Fc,qd,Pt,wi=y(()=>{Zt=$(z(),1);Kt();X();k();at();_i=(t=512,e="icon")=>[`${e}${t}`,`${e}-${t}`,`${e}-${t}x${t}`],Ud=["icon",..._i(),..._i(1024)],Fc=(t=Ud)=>{let e=Be();return t.map(r=>[`${r}.${e.tag}.${process.env.NODE_ENV}.png`,`${r}.${process.env.NODE_ENV}.png`,`${r}.${e.tag}.png`,`${r}.png`]).flat()},qd=[128,64,48,32,16],Pt={baseIconPaths:[],devProvidedIcons:{}}});import{resolve as re}from"path";var ne,Ac,xi=y(()=>{Ur();ne=(t,e)=>t.reduce((r,n)=>(r[n]=e,r),{}),Ac=({sourceDirectory:t,packageFilePath:e,assetsDirectory:r},n,i)=>{let s=P=>[".ts",...i,".js"].flatMap(O=>[re(t,`${P}.${n}${O}`),re(t,`${P}.${process.env.NODE_ENV}${O}`),re(t,`${P}${O}`)]),o=(P,O=[".ts",".js"])=>O.flatMap(L=>[re(t,`${P}.${n}${L}`),re(t,P,`index.${n}${L}`),re(t,`${P}.${process.env.NODE_ENV}${L}`),re(t,P,`index.${process.env.NODE_ENV}${L}`),re(t,`${P}${L}`),re(t,P,`index${L}`)]),a=o("popup",i),l=o("options",i),f=o("devtools",i),c=o("newtab",i),u=o("sidepanel",i),p=o("popup",[".html"]),m=o("options",[".html"]),h=o("devtools",[".html"]),g=o("newtab",[".html"]),_=o("sidepanel",[".html"]),S=di().map(P=>re(t,P)),C=o("background"),T=s("content"),Y=s("sandbox"),de={[e]:2,...ne(S,1),...ne(T,7),...ne(Y,19),...ne(C,5),...ne(a,15),...ne(l,17),...ne(f,13),...ne(c,9),...ne(u,11),...ne(p,16),...ne(m,18),...ne(h,14),...ne(g,10),...ne(_,12)},Fe=re(t,"contents"),Ae=re(t,"sandboxes"),ke=re(t,"tabs"),w=re(t,"background"),b=[[20,Ae],[4,ke],[8,Fe],[6,w],[3,r]],E=new Set(Object.keys(de)),B=new Set([...C,...T,...Y,...a,...l,...f,...c,...u]);return{popupIndexList:a,popupHtmlList:p,optionsIndexList:l,optionsHtmlList:m,devtoolsIndexList:f,devtoolsHtmlList:h,newtabIndexList:c,newtabHtmlList:g,backgroundIndexList:C,backgroundDirectory:w,contentIndexList:T,contentsDirectory:Fe,sidepanelIndexList:u,sidepanelHtmlList:_,sandboxIndexList:Y,sandboxesDirectory:Ae,tabsDirectory:ke,watchPathReasonMap:de,watchDirectoryEntries:b,isEntryPath:P=>B.has(P),knownPathSet:E}}});import{resolve as Wd}from"path";var $c,vi,Vd,Rc,Bc,Si=y(()=>{$c=$(z(),1),vi="messaging",Vd=`${vi}.d.ts`,Rc=(t,e)=>(0,$c.outputFile)(Wd(t.dotPlasmoDirectory,Vd),e),Bc=(t,e)=>`
import "@plasmohq/messaging"

interface MmMetadata {
	${t.join(`
	`)}
}

interface MpMetadata {
	${e.join(`
	`)}
}

declare module "@plasmohq/messaging" {
  interface MessagesMetadata extends MmMetadata {}
  interface PortsMetadata extends MpMetadata {}
}
`});import{readFile as Hd}from"fs/promises";import{resolve as Uc}from"path";import Gd from"json5";var Vr,jc,Jd,zd,qc,Wc=y(()=>{Vr=$(z(),1);Si();gi();jc=".plasmo/index.d.ts",Jd=[hi,vi].map(t=>`import "./${t}"`).join(`
`),zd=async(t,e)=>{let r=Uc(t.projectDirectory,"tsconfig.json"),n=await Hd(r,"utf8"),i=Gd.parse(n),s=new Set(i.include);s.has(e)||(i.include=[e,...s],await(0,Vr.outputJson)(r,i,{spaces:2}))},qc=async t=>{let e=Uc(t.projectDirectory,jc);await Promise.all([(0,Vr.outputFile)(e,Jd),zd(t,jc)])}});import{lstat as Yd}from"fs/promises";import{resolve as Kd}from"path";async function Gr({dotPlasmoDirectory:t,cacheDirectory:e}){await(0,Hr.emptyDir)(t),await(0,Hr.ensureDir)(e)}async function Vc(t){let e=Kd(t.cacheDirectory,"parcel","data.mdb");if(!await A(e))return;let i=(await Yd(e,{bigint:!0})).size/1024n**2n,s=Number(i)/1024;s>1.47&&(d(`Busting large build cache, size: ${s.toFixed(2)} GB`),await Gr(t))}var Hr,bi=y(()=>{Hr=$(z(),1);X();k()});import Xd from"package-json";import Ei from"semver";async function Zd(t=""){switch((await lt()).name){case"npm":return`"npm i -S plasmo@${t}"`;case"pnpm":return`"pnpm i plasmo@${t}"`;case"yarn":return`"yarn add plasmo@${t}"`}}var Jr,Hc,kt,Qt=y(()=>{Jr=$(z(),1);X();k();bi();lr();Hc=async t=>{let{plasmoVersionFilePath:e}=t;if(!await A(e))d("Plasmo version file not found, busting cache..."),await Gr(t);else{let r=await(0,Jr.readJson)(e),n=Ei.coerce(r.version),i=Ei.coerce("0.90.5");(!n||n.major<i.major||n.major===i.major&&n.minor<i.minor)&&(d("Plasmo updated, busting cache..."),await Gr(t))}await(0,Jr.writeJson)(e,{version:"0.90.5"})},kt=async()=>{let t="0.90.5";try{let r=(await Xd("plasmo",{version:"latest"})).version;if(Ei.lt(t,r)){let{default:n}=await import("chalk");j(n.yellowBright(`A new version of plasmo is available: v${r}`));let i=await Zd(r);$i(n.yellow(`Run ${i} to update`))}}catch(e){le('Error fetching package information for "plasmo"',e)}}});var Qd,zr,Gc=y(()=>{k();Qd=t=>N({target:t}),zr=(t,e=Qd)=>{if(Array.isArray(t))return t.map(r=>zr(r,e)).filter(r=>r!==void 0);if(typeof t=="object"){let r={};for(let n in t)t.hasOwnProperty(n)&&(r[n]=zr(t[n],e),r[n]===void 0&&delete r[n]);return Object.keys(r).length===0?void 0:r}else return e(t)}});import{createHash as eh}from"crypto";var Yr,Pi=y(()=>{Yr=t=>eh("md5").update(t).digest("hex").slice(0,18)});import{resolve as Yc}from"path";import{cwd as th}from"process";import Jc from"semver";var Kc,rh,nh,ih,Xc,zc,sh,Zc,Qc,ki=y(()=>{Kc=$(z(),1);zt();X();Pe();rh=["react","svelte","vue","vanilla"],nh=[".tsx",".svelte",".vue",".jsx"],ih=new Set(nh),Xc=t=>ih.has(t),zc="No supported UI library found.  You can file an RFC for a new UI Library here: https://github.com/PlasmoHQ/plasmo/issues",sh=async t=>{if(t.includes(":")){let[e,r]=t.split(":");switch(e){case"file":default:let n=await(0,Kc.readJson)(Yc(th(),r,"package.json"));return Jc.coerce(n.version)?.major}}else return Jc.coerce(t)?.major},Zc=async t=>{let e=t.dependencies??{},r=rh.find(o=>o in e);if(r===void 0)return{name:"vanilla",path:"vanilla",version:8427};let n=await sh(e[r]);if(n===void 0)throw new Error(zc);if(r==="react"&&n<18)return{name:r,path:"react17",version:n};let i=`${r}${n}`,s=Yc(t.templatePath.staticTemplatePath,i);if(!await A(s))throw new Error(zc);return{name:r,path:i,version:n}},Qc=t=>{switch(t){case"svelte":return{uiExts:[".svelte"],mountExt:".ts"};case"vue":return{uiExts:[".vue"],mountExt:".ts"};case"react":return{uiExts:[".tsx",".jsx"],mountExt:".tsx"};case"vanilla":return{uiExts:[".tsx",".jsx"],mountExt:".ts"};default:bt(t)}}});import{readFile as el,writeFile as oh}from"fs/promises";import{join as Ci,relative as ah,resolve as xe}from"path";var Ct,Kr,tl=y(()=>{Ct=$(z(),1);Kt();X();k();Et();Pi();Pe();ki();Kr=class{constructor(e){this.plasmoManifest=e}#i={};#s={};get projectPath(){return this.plasmoManifest.projectPath}get commonPath(){return this.plasmoManifest.commonPath}get mountExt(){return this.plasmoManifest.mountExt}async init(){let[e,...r]=await Promise.all([this.#n(),this.#t("popup"),this.#t("options"),this.#t("newtab"),this.#t("devtools"),this.#t("sidepanel")]);return r}#n=async()=>{let e=xe(this.plasmoManifest.templatePath.staticTemplatePath,"common"),r=xe(this.commonPath.staticDirectory,"common");return(0,Ct.copy)(e,r)};#t=async e=>{d(`Creating static templates for ${e}`);let r=this.projectPath[`${e}IndexList`],n=this.projectPath[`${e}HtmlList`],[i,s]=await Promise.all([r,n].map(c=>Me(c,A))),{staticDirectory:o}=this.commonPath;await(0,Ct.ensureDir)(o);let a=i!==void 0,l=a?ce(ah(o,i)):`~${e}`,f=xe(o,`${e}${this.mountExt}`);return await Promise.all([this.#e(`index${this.mountExt}`,f,{__plasmo_import_module__:l}),this.createPageHtml(e,s)]),a};generateHtml=async(e="",r="",n="")=>{let i={__plasmo_static_index_title__:this.plasmoManifest.name,__plasmo_static_script__:r};return await ar(n)?this.#r(n,e,{...i,"</body>":`<div id="__plasmo"></div><script src="${r}" type="module"></script></body>`}):this.#e("index.html",e,i)};createPageHtml=async(e,r="")=>{let n=xe(this.commonPath.dotPlasmoDirectory,`${e}.html`),i=`./static/${e}${this.mountExt}`;return this.generateHtml(n,i,r)};createPageMount=async e=>{d(`Creating page mount template for ${e.dir}`);let r=xe(this.commonPath.dotPlasmoDirectory,e.dir),n=xe(r,`${e.name}.html`);await(0,Ct.ensureDir)(r);let i=Xc(e.ext),s=xe(r,`${e.name}${this.mountExt}`),o=xe(this.commonPath.sourceDirectory,e.dir,`${e.name}.html`),a=await Promise.all(i?[this.#e(`index${this.mountExt}`,s,{__plasmo_import_module__:`~${ce(Ci(e.dir,e.name))}`}),this.generateHtml(n,`./${e.name}${this.mountExt}`,o)]:[this.generateHtml(n,`~${ce(Ci(e.dir,e.name))}${e.ext}`,o)]);return{htmlPath:n,wereFilesWritten:a.some(l=>l)}};createContentScriptMount=async e=>{d(`Creating content script mount for ${e.dir}`);let r=xe(this.commonPath.staticDirectory,e.dir);await(0,Ct.ensureDir)(r);let n=xe(r,`${e.name}${this.mountExt}`);return await this.#e(`content-script-ui-mount${this.mountExt}`,n,{__plasmo_mount_content_script__:`~${ce(Ci(e.dir,e.name))}`}),n};#o=async(e,r,n)=>{let i=Object.entries(n).reduce((o,[a,l])=>o.replaceAll(a,l),e),s=Yr(Buffer.from(i));return this.#s[r]===s?!1:(this.#s[r]=s,await oh(r,i),!0)};#r=async(e,r,n)=>{let i=await el(e,"utf8");return this.#o(i,r,n)};#e=async(e,r,n)=>(this.#i[e]||=await el(xe(this.plasmoManifest.staticScaffoldPath,e),"utf8"),this.#o(this.#i[e],r,n))}});import{ok as De}from"assert";import{readdir as rl}from"fs/promises";import{basename as ch,dirname as lh,extname as nl,isAbsolute as fh,join as uh,parse as il,relative as Xr,resolve as Ye}from"path";import{cwd as ph}from"process";import mh from"fast-glob";import{hasher as dh}from"node-object-hash";var ie,er,hh,gh,Ot,Pe=y(()=>{ie=$(z(),1);oi();zt();pn();X();k();Et();Ur();gi();cr();Mc();wi();xi();Dn();Wc();bi();Qt();Gc();tl();ki();er={16:"./gen-assets/icon16.plasmo.png",32:"./gen-assets/icon32.plasmo.png",48:"./gen-assets/icon48.plasmo.png",64:"./gen-assets/icon64.plasmo.png",128:"./gen-assets/icon128.plasmo.png"},hh=["storage"],gh=dh({trim:!0,sort:!0}),Ot=class{constructor(e){this.bundleConfig=e;this.data.icons=er,this.scaffolder=new Kr(this)}get browser(){return this.bundleConfig.browser}#i;get commonPath(){return ai(this.#i)}#s;get projectPath(){return ai(this.#s)}templatePath=xr();#n;get combinedEnv(){return De(this.#n),this.#n.combinedEnv}get publicEnv(){return De(this.#n),this.#n.plasmoPublicEnv}#t=new Set([".ts",".js"]);#o=new Set;#r;get uiLibrary(){return De(this.#r),this.#r.uiLibrary}get mountExt(){return De(this.#r),this.#r.uiExtMap.mountExt}get uiExts(){return De(this.#r),this.#r.uiExtMap.uiExts}#e="";#a="";data={};overideManifest={};packageData;contentScriptMap=new Map;get mainWorldScriptList(){let e=[];for(let r of this.contentScriptMap.values())r.world==="MAIN"&&e.push(r);return e}get hasMainWorldScript(){for(let e of this.contentScriptMap.values())if(e.world==="MAIN")return!0;return!1}copyMap=new Map;permissionSet=new Set;scaffolder;get changed(){return this.#e!==this.#a}get name(){return De(this.packageData),this.packageData.displayName}get dependencies(){return De(this.packageData),this.packageData.dependencies??this.packageData.peerDependencies}get devDependencies(){return De(this.packageData),this.packageData.devDependencies}get staticScaffoldPath(){return De(this.uiLibrary),Ye(this.templatePath.staticTemplatePath,this.uiLibrary.path)}async initEnv(e=ph()){this.#n=await Oc(e),this.#i=ct(e)}async startup(){await this.initEnv(),d(`Ensure exists: ${this.commonPath.dotPlasmoDirectory}`),await(0,ie.ensureDir)(this.commonPath.dotPlasmoDirectory),await Vc(this.commonPath),await Hc(this.commonPath),await Wr(this.commonPath),await qc(this.commonPath),await this.updateEnv(),await this.updatePackageData()}async postBuild(){if(await Promise.all(Array.from(this.copyMap,async([n,i])=>{await or(n)||await(0,ie.copy)(i,n)})),!process.env.POST_BUILD_SCRIPT)return;let e=Ye(process.env.POST_BUILD_SCRIPT);if(!(0,ie.existsSync)(e)){j("Post-build script is unavailable:",e);return}v(e)()}async updateEnv(){await this.initEnv(this.commonPath.projectDirectory),await Nc(this)}prefixDev=(e="")=>process.env.NODE_ENV==="development"?`DEV | ${e}`:e;async updatePackageData(){if(this.packageData=await(0,ie.readJson)(this.commonPath.packageFilePath),!this.packageData)throw new Error("Invalid package.json");this.data.version=this.packageData.version,this.data.author=this.packageData.author,this.data.name=this.prefixDev(this.packageData.displayName),this.data.description=this.packageData.description,this.packageData.homepage&&(this.data.homepage_url=this.packageData.homepage);for(let e of hh)`@plasmohq/${e}`in(this.packageData.dependencies||{})&&this.permissionSet.add(e);await this.#c(),this.overideManifest=await this.#l()}#c=async()=>{let e=await Zc(this),r=Qc(e.name);this.#r={uiLibrary:e,uiExtMap:r},this.#o=new Set(r.uiExts),this.uiExts.forEach(n=>{this.#t.add(n)}),this.#s=Ac(this.commonPath,this.browser,this.uiExts)};toggleOptions=(e=!1)=>(e?this.data.options_ui={page:"./options.html",open_in_tab:!0}:delete this.data.options_ui,this);toggleOverrides=(e,r=!1)=>(r?this.data.chrome_url_overrides={...this.data.chrome_url_overrides,[e]:`./${e}.html`}:delete this.data.chrome_url_overrides?.[e],this);toggleNewtab=(e=!1)=>this.toggleOverrides("newtab",e);toggleDevtools=(e=!1)=>(e?this.data.devtools_page="./devtools.html":delete this.data.devtools_page,this);isPathInvalid=e=>{if(e===void 0)return!0;let r=nl(e);if(!this.#t.has(r))return!0;let n=Ec(e);return!!(n.length>0&&n!==`.${this.browser}`||n.length===0&&(0,ie.existsSync)(e.replace(r,`.${this.browser}${r}`)))};toggleContentScript=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=await Ic(e);if(n?.isEmpty)return!1;d("Adding content script: ",e);let i=Xr(this.commonPath.dotPlasmoDirectory,e),s=nl(i),o=this.#o.has(s);if(this.uiLibrary?.name!=="vanilla"&&o){let l=uh("lab",i).replace(/(^src)[\\/]/,""),f=il(l);i=Xr(this.commonPath.dotPlasmoDirectory,await this.scaffolder.createContentScriptMount(f))}n?.config?.css&&n.config.css.length>0&&(n.config.css=n.config.css.map(l=>Xr(this.commonPath.dotPlasmoDirectory,Ye(lh(e),l))));let a=this.injectEnvToObj({matches:["<all_urls>"],js:[n?.config?.world==="MAIN"?i.split(s)[0]:i],...n?.config||{}});this.contentScriptMap.set(e,a)}else this.contentScriptMap.delete(e);return mc("cs_changed"),r};addDirectory=async(e,r,n)=>(0,ie.existsSync)(e)?rl(e,{withFileTypes:!0}).then(i=>Promise.all(i.filter(s=>s.isFile()&&n?n(s.name):!0).map(s=>Ye(e,s.name)).map(s=>r(s,!0)))).then(i=>i.includes(!0)):!1;addContentScriptsIndexFiles=async()=>{let e=this.projectPath.contentsDirectory;if(!await Hi(e))return!1;let r=[...this.#t].flatMap(n=>[`index${n}`,`index.${this.browser}${n}`]);return rl(e,{withFileTypes:!0}).then(n=>Promise.all(n.filter(i=>i.isDirectory()).map(i=>Ye(e,i.name)).map(i=>this.addDirectory(i,this.toggleContentScript,s=>r.includes(s))))).then(n=>n.includes(!0))};addContentScriptsDirectory=async(e=this.projectPath.contentsDirectory)=>Promise.all([this.addDirectory(e,this.toggleContentScript),this.addContentScriptsIndexFiles()]).then(r=>r.includes(!0));togglePage=async(e,r=!1)=>{if(this.isPathInvalid(e))return!1;if(r){let n=Xr(this.commonPath.sourceDirectory,e),i=il(n),{wereFilesWritten:s}=await this.scaffolder.createPageMount(i);s&&(this.#e="")}else this.#e="";return r};addPagesDirectory=async e=>this.addDirectory(e,this.togglePage);write=(e=!1)=>{this.#a=this.#e;let r=this.toJSON();if(this.#e=gh.hash(r),!(!this.changed&&!e))return d("Hash changed, updating manifest"),(0,ie.writeJson)(this.commonPath.entryManifestPath,r,{spaces:2})};toJSON=()=>{let e={...this.data},{options_ui:r,permissions:n,content_scripts:i,background:s,...o}=this.overideManifest;return e.options_ui?.page&&(e.options_ui={...e.options_ui,...r}),e.permissions=[...new Set([...this.permissionSet,...n||[]])],e.permissions?.length===0&&delete e.permissions,this.bundleConfig.manifestVersion==="mv2"&&(e.background={...e.background,...s},Object.keys(e.background).length===0&&delete e.background,o.host_permissions?.length>0&&(e.permissions=[...e.permissions||[],...o.host_permissions])),e.content_scripts=[...Array.from(this.contentScriptMap.values()).filter(a=>a.world!=="MAIN"),...i||[]],e.content_scripts.length===0&&delete e.content_scripts,{...e,...o}};#l=async()=>{if(!this.packageData?.manifest)return{};let e=await this.prepareOverrideManifest();if((e.web_accessible_resources?.length||0)>0&&(e.web_accessible_resources=await this.resolveWAR(this.packageData.manifest.web_accessible_resources)),e.browser_specific_settings)switch(this.browser){case"edge":case"safari":e.browser_specific_settings={[this.browser]:e.browser_specific_settings[this.browser]};break;case"firefox":case"gecko":e.browser_specific_settings={gecko:e.browser_specific_settings.gecko};break;default:delete e.browser_specific_settings}return e.overrides&&e.overrides[this.browser]&&(e={...e,...e.overrides[this.browser]}),delete e.overrides,this.injectEnvToObj(e)};copyProjectFile=async e=>{try{if(e.startsWith("~"))return this.copyProjectFile(e.slice(1));if(e.includes("*")){let s=await mh(e,{cwd:this.commonPath.projectDirectory,onlyFiles:!0});return await Promise.all(s.map(this.copyProjectFile)),e}let r=fh(e)?e:Ye(this.commonPath.projectDirectory,e);if(!(!this.projectPath.isEntryPath(r)&&await(0,ie.pathExists)(r)))return e;let i=Ye(this.commonPath.distDirectory,e);return this.copyMap.set(i,r),ce(e)}catch{return e}};copyNodeModuleFile=async e=>{try{let r=v.resolve(e,{paths:[this.commonPath.projectDirectory]}),n=ch(r),i=Ye(this.commonPath.distDirectory,n);return this.copyMap.set(i,r),n}catch{return null}};injectEnvToObj=e=>zr(e,r=>typeof r!="string"?r:r.match(/^\$(\w+)$/)?this.combinedEnv[r.substring(1)]||void 0:Fi(r,this.combinedEnv))}});import{relative as yh,resolve as sl}from"path";var Zr,ol,al=y(()=>{Zr=$(z(),1);k();Et();Pe();ol=async({indexFilePath:t="",withMessaging:e=!1,withMainWorldScript:r=!1},n)=>{d("Creating BGSW entry");let i=sl(n.commonPath.staticDirectory,"background"),s=sl(i,"index.ts"),o=yh(i,t),a=[e&&'import "./messaging"',t&&`import "${ce(o).slice(0,-3)}"`,r&&'import "./main-world-scripts"'].filter(Boolean).join(`
`);await(0,Zr.ensureDir)(i),await(0,Zr.outputFile)(s,a)}});import{relative as _h,resolve as wh}from"path";import{camelCase as cl}from"change-case";var ll,fl,ul=y(()=>{ll=$(z(),1);k();Et();Pe();fl=async t=>{try{let e=wh(t.commonPath.staticDirectory,"background","main-world-scripts.ts"),r=t.mainWorldScriptList.map(i=>{let s=i.js.map(c=>{let u=cl(c),p=`url:${ce(_h(t.commonPath.entryManifestPath,c))}`;return{importName:u,importPath:p}}),o=s.map(c=>`import ${c.importName} from "${c.importPath}"`).join(`
`),a=s.map(c=>c.importName),l=Object.entries(i).reduce((c,[u,p])=>(u!=="js"&&(c[cl(u)]=p),c),{id:a.join("-"),js:[]}),f=JSON.stringify(l).replace(/"js":\[\]/,`"js":[${a.map(c=>`${c}.split("/").pop().split("?")[0]`).join(",")}]`);return[o,f]});if(r.length===0)return!1;t.permissionSet.add("scripting");let n=`${r.map(([i])=>i).join(`
`)}
chrome.scripting.registerContentScripts([
  ${r.map(([,i])=>i).join(`,
  `)}
]).catch(_ => {})
`;return await(0,ll.outputFile)(e,n),!0}catch(e){return d(e.message),!1}}});import{camelCase as xh}from"change-case";import vh from"fast-glob";import{join as Sh,resolve as bh}from"path";var dl,pl,Eh,Oi,ml,Ph,hl,gl=y(()=>{dl=$(z(),1);X();k();Et();Si();Pi();Pe();pl={md5Hash:""},Eh=(t,e,r,n)=>`// @ts-nocheck
globalThis.__plasmoInternalPortMap = new Map()

${t}

chrome.runtime.onMessageExternal.addListener((request, sender, sendResponse) => {
  switch (request?.name) {
    ${r}
    default:
      break
  }

  return true
})

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  switch (request.name) {
    ${e}
    default:
      break
  }

  return true
})

chrome.runtime.onConnect.addListener(function(port) {
  globalThis.__plasmoInternalPortMap.set(port.name, port)
  port.onMessage.addListener(function(request) {
    switch (port.name) {
      ${n}
      default:
        break
    }
  })
})

`,Oi=async(t,e)=>{let r=Sh(t.projectPath.backgroundDirectory,e);return await sr(r)?(await vh("**/*.ts",{cwd:r,onlyFiles:!0,ignore:e==="messages"?["external"]:[]})).map(i=>{let o=ce(i).slice(0,-3),a=`${e}/${o}`,l=xh(a);return{importName:l,name:o,declaration:`"${o}" : {}`,importCode:`import { default as ${l} } from "~background/${a}"`}}):[]},ml=(t,e)=>`case "${t}":
  ${e}({
    ...request,
    sender
  }, {
    send: (p) => sendResponse(p)
  })
  break`,Ph=(t,e)=>`case "${t}":
  ${e}({
    port,
    ...request
  }, {
    send: (p) => port.postMessage(p)
  })
  break`,hl=async t=>{try{let e=await Promise.all([Oi(t,"messages"),Oi(t,"messages/external"),Oi(t,"ports")]),[r,n,i]=e;if(d({messageHandlerList:r,externalMessageHandlerList:n,portHandlerList:i}),e.every(l=>l.length===0))return!1;if(!("@plasmohq/messaging"in t.dependencies))return j("@plasmohq/messaging is not installed, skipping messaging API"),!1;let s=Bc(r.map(({declaration:l})=>l),i.map(({declaration:l})=>l)),o=Yr(Buffer.from(s));if(pl.md5Hash===o)return!0;pl.md5Hash=o;let a=Eh([...r,...n,...i].map(l=>l.importCode).join(`
`),r.map(l=>ml(l.name,l.importName)).join(`
`),n.map(l=>ml(l.name,l.importName)).join(`
`),i.map(l=>Ph(l.name,l.importName)).join(`
`));return await Promise.all([(0,dl.outputFile)(bh(t.commonPath.staticDirectory,"background","messaging.ts"),a),Rc(t.commonPath,s)]),!0}catch(e){return d(e.message),!1}}});var tr,Li=y(()=>{Kt();X();al();ul();gl();Pe();tr=async t=>{let[e,r,n]=await Promise.all([Me(t.projectPath.backgroundIndexList,A),hl(t),fl(t)]),i=!!e||r||n;return i&&await ol({indexFilePath:e,withMessaging:r,withMainWorldScript:n},t),t.toggleBackground(i)}});import{subscribe as kh}from"@parcel/watcher";var Ch,yl,Oh,_l=y(()=>{Sc();zt();he();k();Li();Pe();wi();xi();Ch=["node_modules","build",".plasmo","coverage",".git"],yl=async t=>{if(R("--impulse"))return null;let{default:e}=await import("is-path-inside"),{knownPathSet:r,watchPathReasonMap:n,watchDirectoryEntries:i}=t.projectPath;d("Watching the following files:",r);let s=o=>{if(r.has(o))return n[o];let a=i.find(([,l])=>e(o,l));return a?(r.add(o),n[o]=a[0]):0};return kh(t.commonPath.projectDirectory,async(o,a)=>{if(o)throw o;await Promise.all(a.map(({path:l,type:f})=>Oh(f,l,s(l),t))),await t.write()},{backend:vc,ignore:Ch})},Oh=async(t,e,r,n)=>{let i=t!=="delete";switch(r){case 0:return;case 1:{j("Environment file change detected, please restart the dev server."),await n.updateEnv();return}case 3:{N("Assets directory changed, update dynamic assets"),await Wr(n.commonPath);return}case 2:{N("package.json changed, updating manifest overrides. You might need to restart the dev server."),await n.updatePackageData();return}case 6:case 5:{await tr(n);return}case 7:case 8:{await n.toggleContentScript(e,i),n.hasMainWorldScript&&await tr(n);return}case 19:case 20:case 4:{await n.togglePage(e,i);return}case 11:{n.toggleSidePanel(i);return}case 15:{n.togglePopup(i);return}case 17:{n.toggleOptions(i);return}case 13:{n.toggleDevtools(i);return}case 9:{n.toggleNewtab(i);return}case 16:{await n.scaffolder.createPageHtml("popup",i&&e);return}case 18:{await n.scaffolder.createPageHtml("options",i&&e);return}case 14:{await n.scaffolder.createPageHtml("devtools",i&&e);return}case 10:{await n.scaffolder.createPageHtml("newtab",i&&e);return}case 12:{await n.scaffolder.createPageHtml("sidepanel",i&&e);return}default:bt(r)}}});import{dirname as Lh,join as Nh,resolve as Th}from"path";import Ih from"@parcel/fs";import Qr from"@parcel/package-manager";import{Parcel as Mh}from"@plasmohq/parcel-core";var ve,Dh,en,Ni=y(()=>{ve=$(z(),1);he();k();lr();Ur();Dh={npm:Qr.Npm,yarn:Qr.Yarn,pnpm:Qr.Pnpm},en=async({commonPath:t,bundleConfig:e,publicEnv:r},{defaultTargetOptions:n={},...i})=>{let s=i.mode==="production";s?await(0,ve.emptyDir)(t.distDirectory):await(0,ve.ensureDir)(t.distDirectory),process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_MINIFY=s&&R("--no-minify")?"true":"false",process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS=s?R("--inline-source-maps")?"inline":R("--source-maps")?"external":"none":R("--no-source-maps")?"none":"inline",process.env.__PLASMO_FRAMEWORK_INTERNAL_NO_CS_RELOAD=R("--no-cs-reload")?"true":"false",process.env.__PLASMO_FRAMEWORK_INTERNAL_ES_TARGET=G("--es-target")||"es2022";let o=await lt(),a=new Ih.NodeFS,l=Dh[o.name],f=new Qr.NodePackageManager(a,t.projectDirectory,new l),c=v.resolve("@plasmohq/parcel-config"),u=Nh(Lh(c),"run.json"),p=await(0,ve.readJson)(c);R("--bundle-buddy")&&(p.reporters=["...","@parcel/reporter-bundle-buddy"]),await(0,ve.writeJson)(u,p),await(0,ve.exists)(t.parcelConfig)&&(u=t.parcelConfig,s&&(await(0,ve.readJson)(u)).extends!=="@plasmohq/parcel-config"&&j('The .parcelrc does not extend "@plasmohq/parcel-config", the result may be unexpected'),R("--bundle-buddy")&&j('The "--bundle-buddy" flag does not work with a custom .parcelrc file'));let m={browsers:e.manifestVersion==="mv2"&&e.browser!=="firefox"?["IE 11"]:["last 1 Chrome version"]};return Cc(e),new Mh({inputFS:a,packageManager:f,entries:t.entryManifestPath,cacheDir:Th(t.cacheDirectory,"parcel"),config:u,shouldAutoInstall:!0,env:r.extends(e).data,defaultTargetOptions:{...n,engines:m,sourceMaps:process.env.__PLASMO_FRAMEWORK_INTERNAL_SOURCE_MAPS!=="none",distDir:t.distDirectory},...i})}});var wl,me,xl,tn,vl=y(()=>{wl="\u{1F504} Building",me={loadingInterval:null,isLoading:!1,dotCount:0},xl=()=>{me.isLoading||(me.isLoading=!0,process.stdout.write(wl),me.loadingInterval=setInterval(()=>{me.dotCount=(me.dotCount+1)%4;let t=me.dotCount===0?"   ":".".repeat(me.dotCount);process.stdout.write(`\r${wl}${t}`)},400))},tn=()=>{me.isLoading&&(me.isLoading=!1,me.loadingInterval&&(clearInterval(me.loadingInterval),me.loadingInterval=null),process.stdout.write("\r"+" ".repeat(20)+"\r"))}});var rn,Sl=y(()=>{k();Pe();rn=class extends Ot{constructor(e){super(e),this.data.manifest_version=2,this.data.browser_action={default_icon:er}}toggleSidePanel=(e=!1)=>{switch(this.browser){case"firefox":case"gecko":{e?this.data.sidebar_action={default_panel:"./sidepanel.html"}:delete this.data.sidebar_action;break}default:N("SidePanel is not available on chromium-based MV2 browsers, skipping.")}return this};togglePopup=(e=!1)=>(e?this.data.browser_action.default_popup="./popup.html":delete this.data.browser_action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={scripts:["./static/background/index.ts"]}:delete this.data.background,e);prepareOverrideManifest=()=>{let{manifest:e}=this.packageData,r={...e};return r.permissions=[...e.permissions||[],...e.host_permissions||[]],"host_permissions"in r&&delete r.host_permissions,"content_security_policy"in e&&(r.content_security_policy=e.content_security_policy?.extension_pages),r};resolveWAR=e=>Promise.all(e.map(async({resources:r})=>(await Promise.all(r.map(async i=>await this.copyNodeModuleFile(i)||await this.copyProjectFile(i)))).flat())).then(r=>r.flat())}});var nn,bl=y(()=>{Pe();nn=class extends Ot{constructor(e){super(e),this.data.manifest_version=3,this.data.action={default_icon:er}}toggleSidePanel=(e=!1)=>{switch(this.browser){case"firefox":case"gecko":{e?this.data.sidebar_action={default_panel:"./sidepanel.html"}:delete this.data.sidebar_action;break}default:e?(this.data.side_panel={default_path:"./sidepanel.html"},this.permissionSet.add("sidePanel")):(delete this.data.side_panel,this.permissionSet.delete("sidePanel"))}return this};togglePopup=(e=!1)=>(e?this.data.action.default_popup="./popup.html":delete this.data.action.default_popup,this);toggleBackground=(e=!1)=>(e?this.data.background={service_worker:"./static/background/index.ts"}:delete this.data.background,e);prepareOverrideManifest=()=>({...this.packageData.manifest});resolveWAR=e=>Promise.all(e.map(async({resources:r,...n})=>({resources:(await Promise.all(r.map(async s=>await this.copyNodeModuleFile(s)||await this.copyProjectFile(s)))).flat(),...n})))}});async function Lt(t){d("Creating Manifest Factory...");let e=t.manifestVersion==="mv3"?new nn(t):new rn(t);await e.startup();let{contentIndexList:r,sandboxIndexList:n,tabsDirectory:i,sandboxesDirectory:s}=e.projectPath,[o,a]=await Promise.all([r,n].map(g=>Me(g,A))),l=await Promise.all([e.scaffolder.init(),e.togglePage(a,!0),e.toggleContentScript(o,!0),e.addContentScriptsDirectory(),e.addPagesDirectory(i),e.addPagesDirectory(s)]);l.push(await tr(e));let f=l.flat();f.includes(!0)||j("Unable to find any entry files. The extension might be empty");let[c,u,p,m,h]=f;return e.togglePopup(c).toggleOptions(u).toggleNewtab(p).toggleDevtools(m).toggleSidePanel(h),await e.write(!0),e}var sn=y(()=>{Kt();X();k();Li();Sl();bl()});var El={};Xe(El,{default:()=>Ah});async function Fh(){fe(),kt(),process.env.NODE_ENV="development";let t=G("--serve-port")||"1012",e=G("--serve-host")||"localhost",r=G("--hmr-port")||"1815",n=G("--hmr-host")||"localhost";N("Starting the extension development server...");let{default:i}=await import("get-port"),[s,o]=await Promise.all([i({port:parseInt(t)}),i({port:parseInt(r)})]),a=si(n,o);d(`Starting dev server on ${e}:${s}, HMR on ${n}:${o}...`);let l=St();N("Building for target:",l.target);let f=await Lt(l),c=await yl(f),u=await en(f,{logLevel:"verbose",shouldBundleIncrementally:!0,serveOptions:{host:e,port:s},hmrOptions:{host:n,port:o}}),{default:p}=await import("chalk"),m=await u.watch(async(g,_)=>{if(g)throw tn(),g;if(_!==void 0){if(_.type==="buildStart"){xl();return}if(_.type==="buildSuccess"){tn(),Re(`Extension re-packaged in ${p.bold(_.buildTime)}ms! \u{1F680}`),await f.postBuild(),a.broadcast("build_ready");return}_.type==="buildFailure"&&(tn(),Nt()||le(p.redBright(`Build failed. To debug, run ${p.bold("plasmo dev --verbose")}.`)),_.diagnostics.forEach(S=>{le(p.redBright(S.message)),S.stack&&d(S.stack),S.hints?.forEach(C=>{d(C)}),S.codeFrames?.forEach(C=>{C.code&&d(C.code),C.codeHighlights.forEach(T=>{T.message&&d(T.message),d(p.underline(`${C.filePath}:${T.start.line}:${T.start.column}`))})})})),process.env.__PLASMO_FRAMEWORK_INTERNAL_WATCHER_STARTED="true"}}),h=()=>{c?.unsubscribe(),m.unsubscribe()};process.on("SIGINT",h),process.on("SIGTERM",h)}var Ah,Pl=y(()=>{oi();he();k();Rr();_l();Qt();Ni();vl();Ze();sn();Ah=Fh});import{readdir as $h,readFile as Rh,rename as kl,stat as Bh,writeFile as jh}from"fs/promises";import{join as Uh,resolve as qh}from"path";var Wh,Ti,Cl=y(()=>{Wh=async t=>{let r=(await Rh(qh(t),"utf8")).replace(/\/_/g,"/");await jh(t,r,"utf8")},Ti=async(t="")=>{let e=await $h(t);for(let r of e){let n=Uh(t,r);if((await Bh(n)).isDirectory()){let s=n.replace("/_","/");await kl(n,s),await Ti(s)}else{let s=n.replace("/_","/");await kl(n,s),await Wh(s)}}}});import{mkdir as Vh}from"fs/promises";import{resolve as Ii}from"path";import{sentenceCase as Hh}from"change-case";var Ke,Gh,Ol,Ll=y(()=>{Ke=$(z(),1);X();k();cr();Cl();Gh=t=>({name:Hh(t.name),description:t.description,version:t.version,manifest_version:3,chrome_url_overrides:{newtab:"./index.html"}}),Ol=async()=>{let{projectDirectory:t,packageFilePath:e}=ct();d("Creating a Plasmo + Nextjs based new tab extension");let r=Ii(t,"out"),{default:n}=await import("chalk");if(!await A(r))throw new Error(`${n.bold("out")} directory does not exist, did you forget to run "${n.underline("next build && next export")}"?`);let i=await(0,Ke.readJson)(e),s=Ii(t,"extension");if(await A(s)){let{default:{prompt:o}}=await import("inquirer"),{answer:a}=await o({type:"confirm",name:"answer",message:`${n.bold("extension")} directory already exists, do you want to overwrite it?`});if(!a)throw new Error("Aborted");await(0,Ke.emptyDir)(s)}await Vh(s),await(0,Ke.copy)(r,s),d("Extension created at:",s),await Ti(s),await(0,Ke.writeJson)(Ii(s,"manifest.json"),Gh(i),{spaces:2}),Re("Your extension is ready in the extension/ directory")}});import{createReadStream as Jh,createWriteStream as zh}from"fs";import{resolve as Nl}from"path";import Yh from"fast-glob";import{AsyncZipDeflate as Kh,Zip as Xh}from"fflate";function Zh(t){return t/1024/1024}var on,Mi=y(()=>{k();on=async({distDirectory:t,buildDirectory:e,distDirectoryName:r},n=!1)=>{let i=Nl(e,`${r}.zip`),s=zh(i),o=await Yh(["**/*",!n&&"!**/(*.js.map|*.css.map)"].filter(Boolean),{cwd:t,onlyFiles:!0});return new Promise((a,l)=>{let f=0,c=!1,u=Date.now(),p=new Xh((m,h,g)=>{c||(m?l(m):(f+=h.length,s.write(h),g&&(N(`Zip Package size: ${Zh(f).toFixed(2)} MB in ${Date.now()-u}ms`),s.end(),a())))});for(let m of o){if(c)return;let h=new Kh(m,{level:9});p.add(h);let g=Nl(t,m);Jh(g).on("data",_=>{h.push(_,!1)}).on("end",()=>{h.push(new Uint8Array(0),!0)}).on("error",_=>{c=!0,p.terminate(),l(`Error reading file ${g}: ${_.message}`)})}p.end()})}});var Tl={};Xe(Tl,{default:()=>eg});async function Qh(){fe(),kt(),process.env.NODE_ENV="production";let[t]=rr("build");if(t==="next-new-tab"){await Ol();return}N("Prepare to bundle the extension...");let e=St();N("Building for target:",e.target);let r=await Lt(e),i=await(await en(r,{mode:"production",shouldDisableCache:!0,shouldContentHash:!1,defaultTargetOptions:{shouldOptimize:!0,shouldScopeHoist:R("--hoist")}})).run();Re(`Finished in ${i.buildTime}ms!`),await r.postBuild(),R("--zip")&&await on(r.commonPath)}var eg,Il=y(()=>{nr();he();k();Rr();Ll();Qt();Ni();Ze();sn();Mi();eg=Qh});var Ml={};Xe(Ml,{default:()=>rg});async function tg(){fe(),kt(),process.env.NODE_ENV="production",N("Prepare to package the extension bundle...");let t=St(),e=await Lt(t);await on(e.commonPath,R("--with-source-maps"))}var rg,Dl=y(()=>{he();k();Rr();Qt();Ze();sn();Mi();rg=tg});var an={};Xe(an,{default:()=>ig});async function ng(){console.log("0.90.5")}var ig,cn=y(()=>{ig=ng});var ln,mn,Fl,dn=y(()=>{ln={help:()=>Promise.resolve().then(()=>(Ui(),ji)),start:()=>Promise.resolve().then(()=>(Wi(),qi)),init:()=>Promise.resolve().then(()=>(sa(),ia)),dev:()=>Promise.resolve().then(()=>(Pl(),El)),build:()=>Promise.resolve().then(()=>(Il(),Tl)),package:()=>Promise.resolve().then(()=>(Dl(),Ml)),version:()=>Promise.resolve().then(()=>(cn(),an)),"-v":()=>Promise.resolve().then(()=>(cn(),an)),"--version":()=>Promise.resolve().then(()=>(cn(),an))},mn=Object.keys(ln),Fl=new Set(mn)});import{argv as Al,exit as Di,versions as sg}from"process";import og from"semver";he();k();dn();Ze();async function ag(){fe(),ir()}async function cg(){try{if(Al.length>10)throw new Error("Too many arguments provided.");if(og.major(sg.node)<16)throw new Error("Node version must be >= 16");process.env.VERBOSE=Ai?"true":"false";let t=Al.find(e=>Fl.has(e));if(t in ln){d("Running command:",t);let{default:e}=await ln[t]();await e()}else d("Running default mode"),await ag()}catch(t){le(t?.message||"Unknown error."),d(t?.stack),Di(1)}}cg();process.on("SIGINT",()=>Di(0));process.on("SIGTERM",()=>Di(0));
